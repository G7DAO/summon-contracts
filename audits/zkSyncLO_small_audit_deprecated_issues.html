<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="mobile-web-app-capable" content="yes">
    <title>
        zkSyncLO meeting [DRAFT] - HackMD
    </title>
    <link rel="icon" type="image/png" href="https://hackmd.io/favicon.png">
    <link rel="apple-touch-icon" href="https://hackmd.io/apple-touch-icon.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css" integrity="sha256-3iu9jgsy9TpTwXKb7bNQzqWekRX7pPK+2OLj3R922fo=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/octicons/3.5.0/octicons.min.css" integrity="sha256-QiWfLIsCT02Sdwkogf6YMiQlj4NE84MKkzEMkZnMGdg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.1/themes/prism.min.css" integrity="sha256-vtR0hSWRc3Tb26iuN2oZHt3KRUomwTufNIf5/4oeCyg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/css/basic/emojify.min.css" integrity="sha256-UOrvMOsSDSrW6szVLe8ZDZezBxh5IoIfgTwdNDgTjiU=" crossorigin="anonymous" />
    <style>
        @import url(https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i|Source+Code+Pro:300,400,500|Source+Sans+Pro:300,300i,400,400i,600,600i|Source+Serif+Pro&subset=latin-ext);.hljs{background:#fff;color:#333;display:block;overflow-x:auto;padding:.5em}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-string,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#a71d5d}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#0086b3}.hljs-built_in,.hljs-builtin-name{color:#005cc5}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#795da3}.hljs-addition{background-color:#eaffea;color:#55a532}.hljs-deletion{background-color:#ffecec;color:#bd2c00}.hljs-link{text-decoration:underline}.markdown-body{word-wrap:break-word;font-size:16px;line-height:1.5}.markdown-body:after,.markdown-body:before{content:"";display:table}.markdown-body:after{clear:both}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body .absent{color:#c00}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body blockquote,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-bottom:16px;margin-top:0}.markdown-body hr{background-color:#e7e7e7;border:0;height:.25em;margin:24px 0;padding:0}.markdown-body blockquote{border-left:.25em solid #ddd;color:#777;font-size:16px;padding:0 1em}.markdown-body blockquote>:first-child{margin-top:0}.markdown-body blockquote>:last-child{margin-bottom:0}.markdown-body kbd,.popover kbd{background-color:#fcfcfc;border:1px solid;border-color:#ccc #ccc #bbb;border-radius:3px;box-shadow:inset 0 -1px 0 #bbb;color:#555;display:inline-block;font-size:11px;line-height:10px;padding:3px 5px;vertical-align:middle}.markdown-body .loweralpha{list-style-type:lower-alpha}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:600;line-height:1.25;margin-bottom:16px;margin-top:24px}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#000;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1 code,.markdown-body h1 tt,.markdown-body h2 code,.markdown-body h2 tt,.markdown-body h3 code,.markdown-body h3 tt,.markdown-body h4 code,.markdown-body h4 tt,.markdown-body h5 code,.markdown-body h5 tt,.markdown-body h6 code,.markdown-body h6 tt{font-size:inherit}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{border-bottom:1px solid #eee;padding-bottom:.3em}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{color:#777;font-size:.85em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol.no-list,.markdown-body ul.no-list{list-style-type:none;padding:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-bottom:0;margin-top:0}.markdown-body li>p{margin-top:16px}.markdown-body li+li{padding-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{font-size:1em;font-style:italic;font-weight:700;margin-top:16px;padding:0}.markdown-body dl dd{margin-bottom:16px;padding:0 16px}.markdown-body table{display:block;overflow:auto;width:100%;word-break:normal;word-break:keep-all}.markdown-body table th{font-weight:700}.markdown-body table td,.markdown-body table th{border:1px solid #ddd;padding:6px 13px}.markdown-body table tr{background-color:#fff;border-top:1px solid #ccc}.markdown-body table tr:nth-child(2n){background-color:#f8f8f8}.markdown-body img{background-color:#fff;box-sizing:initial;max-width:100%}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body .emoji{background-color:initial;max-width:none;vertical-align:text-top}.markdown-body span.frame{display:block;overflow:hidden}.markdown-body span.frame>span{border:1px solid #ddd;display:block;float:left;margin:13px 0 0;overflow:hidden;padding:7px;width:auto}.markdown-body span.frame span img{display:block;float:left}.markdown-body span.frame span span{clear:both;color:#333;display:block;padding:5px 0 0}.markdown-body span.align-center{clear:both;display:block;overflow:hidden}.markdown-body span.align-center>span{display:block;margin:13px auto 0;overflow:hidden;text-align:center}.markdown-body span.align-center span img{margin:0 auto;text-align:center}.markdown-body span.align-right{clear:both;display:block;overflow:hidden}.markdown-body span.align-right>span{display:block;margin:13px 0 0;overflow:hidden;text-align:right}.markdown-body span.align-right span img{margin:0;text-align:right}.markdown-body span.float-left{display:block;float:left;margin-right:13px;overflow:hidden}.markdown-body span.float-left span{margin:13px 0 0}.markdown-body span.float-right{display:block;float:right;margin-left:13px;overflow:hidden}.markdown-body span.float-right>span{display:block;margin:13px auto 0;overflow:hidden;text-align:right}.markdown-body code,.markdown-body tt{background-color:#0000000a;border-radius:3px;font-size:85%;margin:0;padding:.2em 0}.markdown-body code:after,.markdown-body code:before,.markdown-body tt:after,.markdown-body tt:before{content:"\00a0";letter-spacing:-.2em}.markdown-body code br,.markdown-body tt br{display:none}.markdown-body del code{text-decoration:inherit}.markdown-body pre{word-wrap:normal}.markdown-body pre>code{background:#0000;border:0;font-size:100%;margin:0;padding:0;white-space:pre;word-break:normal}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{border-radius:3px;font-size:85%;line-height:1.45;overflow:auto}.markdown-body:not(.next-editor) pre{background-color:#f7f7f7;padding:16px}.markdown-body pre code,.markdown-body pre tt{word-wrap:normal;background-color:initial;border:0;display:inline;line-height:inherit;margin:0;max-width:auto;overflow:visible;padding:0}.markdown-body pre code:after,.markdown-body pre code:before,.markdown-body pre tt:after,.markdown-body pre tt:before{content:normal}.markdown-body .csv-data td,.markdown-body .csv-data th{font-size:12px;line-height:1;overflow:hidden;padding:5px;text-align:left;white-space:nowrap}.markdown-body .csv-data .blob-line-num{background:#fff;border:0;padding:10px 8px 9px;text-align:right}.markdown-body .csv-data tr{border-top:0}.markdown-body .csv-data th{background:#f8f8f8;border-top:0;font-weight:700}.news .alert .markdown-body blockquote{border:0;padding:0 0 0 40px}.activity-tab .news .alert .commits,.activity-tab .news .markdown-body blockquote{padding-left:0}.task-list-item{list-style-type:none}.task-list-item label{font-weight:400}.task-list-item.enabled label{cursor:pointer}.task-list-item+.task-list-item{margin-top:3px}.task-list-item-checkbox{cursor:default!important;float:left;margin:.31em 0 .2em -1.3em!important;vertical-align:middle}.markdown-body{max-width:758px;overflow:visible!important;padding-bottom:40px;padding-top:40px;position:relative}.markdown-body.next-editor{overflow-x:hidden!important}.markdown-body .emoji{vertical-align:top}.markdown-body pre{border:inherit!important}.markdown-body code{color:inherit!important}.markdown-body pre code .wrapper{display:-moz-inline-flex;display:-ms-inline-flex;display:-o-inline-flex;display:inline-flex}.markdown-body pre code .gutter{float:left;overflow:hidden;-webkit-user-select:none;user-select:none}.markdown-body pre code .gutter.linenumber{border-right:3px solid #6ce26c!important;box-sizing:initial;color:#afafaf!important;cursor:default;display:inline-block;min-width:20px;padding:0 8px 0 0;position:relative;text-align:right;z-index:4}.markdown-body pre code .gutter.linenumber>span:before{content:attr(data-linenumber)}.markdown-body pre code .code{float:left;margin:0 0 0 16px}.markdown-body .gist .line-numbers{border-bottom:none;border-left:none;border-top:none}.markdown-body .gist .line-data{border:none}.markdown-body .gist table{border-collapse:inherit!important;border-spacing:0}.markdown-body code[data-gist-id]{background:none;padding:0}.markdown-body code[data-gist-id]:after,.markdown-body code[data-gist-id]:before{content:""}.markdown-body code[data-gist-id] .blob-num{border:unset}.markdown-body code[data-gist-id] table{margin-bottom:unset;overflow:unset}.markdown-body code[data-gist-id] table tr{background:unset}.markdown-body[dir=rtl] pre{direction:ltr}.markdown-body[dir=rtl] code{direction:ltr;unicode-bidi:embed}.markdown-body .alert{display:flex;flex-direction:column;gap:16px}.markdown-body .alert>*{margin:0}.markdown-body pre.abc,.markdown-body pre.flow-chart,.markdown-body pre.graphviz,.markdown-body pre.mermaid,.markdown-body pre.sequence-diagram,.markdown-body pre.vega{background-color:inherit;border-radius:0;overflow:visible;text-align:center;white-space:inherit}.markdown-body pre.abc>code,.markdown-body pre.flow-chart>code,.markdown-body pre.graphviz>code,.markdown-body pre.mermaid>code,.markdown-body pre.sequence-diagram>code,.markdown-body pre.vega>code{text-align:left}.markdown-body pre.abc>svg,.markdown-body pre.flow-chart>svg,.markdown-body pre.graphviz>svg,.markdown-body pre.mermaid>svg,.markdown-body pre.sequence-diagram>svg,.markdown-body pre.vega>svg{height:100%;max-width:100%}.markdown-body pre>code.wrap{word-wrap:break-word;white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap}.markdown-body summary{display:list-item}.markdown-body summary:focus{outline:none}.markdown-body details summary{cursor:pointer}.markdown-body details:not([open])>:not(summary){display:none}.markdown-body figure{margin:1em 40px}.markdown-body .mark,.markdown-body mark{background-color:#fff1a7}.vimeo,.youtube{background-color:#000;background-position:50%;background-repeat:no-repeat;background-size:contain;cursor:pointer;display:table;overflow:hidden;text-align:center}.vimeo,.youtube{position:relative;width:100%}.youtube{padding-bottom:56.25%}.vimeo img{object-fit:contain;width:100%;z-index:0}.youtube img{object-fit:cover;z-index:0}.vimeo iframe,.youtube iframe,.youtube img{height:100%;left:0;position:absolute;top:0;width:100%}.vimeo iframe,.youtube iframe{vertical-align:middle;z-index:1}.vimeo .icon,.youtube .icon{color:#fff;height:auto;left:50%;opacity:.3;position:absolute;top:50%;transform:translate(-50%,-50%);transition:opacity .2s;width:auto;z-index:0}.vimeo:hover .icon,.youtube:hover .icon{opacity:.6;transition:opacity .2s}.slideshare .inner,.speakerdeck .inner{position:relative;width:100%}.slideshare .inner iframe,.speakerdeck .inner iframe{bottom:0;height:100%;left:0;position:absolute;right:0;top:0;width:100%}.figma{display:table;padding-bottom:56.25%;position:relative;width:100%}.figma iframe{border:1px solid #eee;bottom:0;height:100%;left:0;position:absolute;right:0;top:0;width:100%}.markmap-container{height:300px}.markmap-container>svg{height:100%;width:100%}.MJX_Assistive_MathML{display:none}#MathJax_Message{z-index:1000!important}.ui-infobar{color:#777;margin:25px auto -25px;max-width:760px;position:relative;z-index:2}.toc .invisable-node{list-style-type:none}.ui-toc{bottom:20px;position:fixed;z-index:998}.ui-toc.both-mode{margin-left:8px}.ui-toc.both-mode .ui-toc-label{border-bottom-left-radius:0;border-top-left-radius:0;height:40px;padding:10px 4px}.ui-toc-label{background-color:#e6e6e6;border:none;color:#868686;transition:opacity .2s}.ui-toc .open .ui-toc-label{color:#fff;opacity:1;transition:opacity .2s}.ui-toc-label:focus{background-color:#ccc;color:#000;opacity:.3}.ui-toc-label:hover{background-color:#ccc;opacity:1;transition:opacity .2s}.ui-toc-dropdown{margin-bottom:20px;margin-top:20px;max-height:70vh;max-width:45vw;overflow:auto;padding-left:10px;padding-right:10px;text-align:inherit;width:25vw}.ui-toc-dropdown>.toc{max-height:calc(70vh - 100px);overflow:auto}.ui-toc-dropdown[dir=rtl] .nav{letter-spacing:.0029em;padding-right:0}.ui-toc-dropdown a{overflow:hidden;text-overflow:ellipsis;white-space:pre}.ui-toc-dropdown .nav>li>a{color:#767676;display:block;font-size:13px;font-weight:500;padding:4px 20px}.ui-toc-dropdown .nav>li:first-child:last-child>ul,.ui-toc-dropdown .toc.expand ul{display:block}.ui-toc-dropdown .nav>li>a:focus,.ui-toc-dropdown .nav>li>a:hover{background-color:initial;border-left:1px solid #000;color:#000;padding-left:19px;text-decoration:none}.ui-toc-dropdown[dir=rtl] .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav>li>a:hover{border-left:none;border-right:1px solid #000;padding-right:19px}.ui-toc-dropdown .nav>.active:focus>a,.ui-toc-dropdown .nav>.active:hover>a,.ui-toc-dropdown .nav>.active>a{background-color:initial;border-left:2px solid #000;color:#000;font-weight:700;padding-left:18px}.ui-toc-dropdown[dir=rtl] .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav>.active>a{border-left:none;border-right:2px solid #000;padding-right:18px}.ui-toc-dropdown .nav .nav{display:none;padding-bottom:10px}.ui-toc-dropdown .nav>.active>ul{display:block}.ui-toc-dropdown .nav .nav>li>a{font-size:12px;font-weight:400;padding-bottom:1px;padding-left:30px;padding-top:1px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a{padding-right:30px}.ui-toc-dropdown .nav .nav>li>ul>li>a{font-size:12px;font-weight:400;padding-bottom:1px;padding-left:40px;padding-top:1px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a{padding-right:40px}.ui-toc-dropdown .nav .nav>li>a:focus,.ui-toc-dropdown .nav .nav>li>a:hover{padding-left:29px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:hover{padding-right:29px}.ui-toc-dropdown .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown .nav .nav>li>ul>li>a:hover{padding-left:39px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:hover{padding-right:39px}.ui-toc-dropdown .nav .nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>a{font-weight:500;padding-left:28px}.ui-toc-dropdown[dir=rtl] .nav .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>a{padding-right:28px}.ui-toc-dropdown .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active>a{font-weight:500;padding-left:38px}.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active>a{padding-right:38px}.markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html[lang^=ja] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ ゴシック,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html[lang=zh-tw] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html[lang=zh-cn] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html .markdown-body[lang^=ja]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ ゴシック,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html .markdown-body[lang=zh-tw]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html .markdown-body[lang=zh-cn]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html[lang^=ja] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Meiryo UI,MS PGothic,ＭＳ Ｐゴシック,sans-serif}html[lang=zh-tw] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Microsoft JhengHei UI,微軟正黑UI,sans-serif}html[lang=zh-cn] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Microsoft YaHei UI,微软雅黑UI,sans-serif}html .ui-toc-dropdown[lang^=ja]{font-family:Source Sans Pro,Helvetica,Arial,Meiryo UI,MS PGothic,ＭＳ Ｐゴシック,sans-serif}html .ui-toc-dropdown[lang=zh-tw]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft JhengHei UI,微軟正黑UI,sans-serif}html .ui-toc-dropdown[lang=zh-cn]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft YaHei UI,微软雅黑UI,sans-serif}.ui-affix-toc{max-height:70vh;max-width:15vw;overflow:auto;position:fixed;top:0}.back-to-top,.expand-toggle,.go-to-bottom{color:#999;display:block;font-size:12px;font-weight:500;margin-left:10px;margin-top:10px;padding:4px 10px}.back-to-top:focus,.back-to-top:hover,.expand-toggle:focus,.expand-toggle:hover,.go-to-bottom:focus,.go-to-bottom:hover{color:#563d7c;text-decoration:none}.back-to-top,.go-to-bottom{margin-top:0}.ui-user-icon{background-position:50%;background-repeat:no-repeat;background-size:cover;border-radius:50%;display:block;height:20px;margin-bottom:2px;margin-right:5px;margin-top:2px;width:20px}.ui-user-icon.small{display:inline-block;height:18px;margin:0 0 .2em;vertical-align:middle;width:18px}.ui-infobar>small>span{line-height:22px}.ui-infobar>small .dropdown{display:inline-block}.ui-infobar>small .dropdown a:focus,.ui-infobar>small .dropdown a:hover{text-decoration:none}.ui-more-info{color:#888;cursor:pointer;vertical-align:middle}.ui-more-info .fa{font-size:16px}.ui-connectedGithub,.ui-published-note{color:#888}.ui-connectedGithub{line-height:23px;white-space:nowrap}.ui-connectedGithub a.file-path{color:#888;padding-left:22px;text-decoration:none}.ui-connectedGithub a.file-path:active,.ui-connectedGithub a.file-path:hover{color:#888;text-decoration:underline}.ui-connectedGithub .fa{font-size:20px}.ui-published-note .fa{font-size:20px;vertical-align:top}.unselectable{-webkit-user-select:none;-o-user-select:none;user-select:none}.selectable{-webkit-user-select:text;-o-user-select:text;user-select:text}.inline-spoiler-section{cursor:pointer}.inline-spoiler-section .spoiler-text{background-color:#333;border-radius:2px}.inline-spoiler-section .spoiler-text>*{opacity:0}.inline-spoiler-section .spoiler-img{filter:blur(10px)}.inline-spoiler-section.raw{background-color:#333;border-radius:2px}.inline-spoiler-section.raw>*{opacity:0}.inline-spoiler-section.unveil{cursor:auto}.inline-spoiler-section.unveil .spoiler-text{background-color:#3333331a}.inline-spoiler-section.unveil .spoiler-text>*{opacity:1}.inline-spoiler-section.unveil .spoiler-img{filter:none}@media print{blockquote,div,img,pre,table{page-break-inside:avoid!important}a[href]:after{font-size:12px!important}}.markdown-body.slides{color:#222;position:relative;z-index:1}.markdown-body.slides:before{background-color:currentColor;bottom:0;box-shadow:0 0 0 50vw;content:"";display:block;left:0;position:absolute;right:0;top:0;z-index:-1}.markdown-body.slides section[data-markdown]{background-color:#fff;margin-bottom:1.5em;position:relative;text-align:center}.markdown-body.slides section[data-markdown] code{text-align:left}.markdown-body.slides section[data-markdown]:before{content:"";display:block;padding-bottom:56.23%}.markdown-body.slides section[data-markdown]>div:first-child{left:1em;max-height:100%;overflow:hidden;position:absolute;right:1em;top:50%;transform:translateY(-50%)}.markdown-body.slides section[data-markdown]>ul{display:inline-block}.markdown-body.slides>section>section+section:after{border:3px solid #777;content:"";height:1.5em;position:absolute;right:1em;top:-1.5em}.site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,sans-serif}html[lang^=ja] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ ゴシック,sans-serif}html[lang=zh-tw] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html[lang=zh-cn] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}body{font-smoothing:subpixel-antialiased!important;-webkit-font-smoothing:subpixel-antialiased!important;-moz-osx-font-smoothing:auto!important;-webkit-overflow-scrolling:touch;font-family:Source Sans Pro,Helvetica,Arial,sans-serif;letter-spacing:.025em}html[lang^=ja] body{font-family:Source Sans Pro,Helvetica,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ ゴシック,sans-serif}html[lang=zh-tw] body{font-family:Source Sans Pro,Helvetica,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html[lang=zh-cn] body{font-family:Source Sans Pro,Helvetica,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}abbr[data-original-title],abbr[title]{cursor:help}body.modal-open{overflow-y:auto;padding-right:0!important}svg{text-shadow:none}
    </style>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" integrity="sha256-3Jy/GbSLrg0o9y5Z5n1uw0qxZECH7C6OQpVBgNFYa0g=" crossorigin="anonymous"></script>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js" integrity="sha256-g6iAfvZp+nDQ2TdTR/VVKJf3bGro4ub5fvWSWVRi2NE=" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js" integrity="sha256-8E4Is26QH0bD52WoQpcB+R/tcWQtpzlCojrybUd7Mxo=" crossorigin="anonymous"></script>
    <![endif]-->
</head>

<body>
    <div id="doc" class="markdown-body container-fluid comment-enabled" data-hard-breaks="true"><h3 id="Critical-AvatarBoundV1-can’t-mint-Soulbound1155-tokens" data-id="Critical-AvatarBoundV1-can’t-mint-Soulbound1155-tokens"><a class="anchor hidden-xs" href="#Critical-AvatarBoundV1-can’t-mint-Soulbound1155-tokens" title="Critical-AvatarBoundV1-can’t-mint-Soulbound1155-tokens"><span class="octicon octicon-link"></span></a><span>[Critical] </span><code>AvatarBoundV1</code><span> can’t mint </span><code>Soulbound1155</code><span> tokens</span></h3><p><strong><span>File(s)</span></strong><span>: </span><a href="" target="_blank" rel="noopener"><code>AvatarBoundV1</code></a></p><p><strong><span>Description</span></strong><span>: The </span><code>AvatarBoundV1</code><span> is minting </span><code>Soulbound1155</code><span> tokens in functions </span><code>mintItem(...)</code><span> and </span><code>mintRandomItem(...)</code><span>, as presented below:</span></p><pre><code class="solidity hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mintItem</span>(<span class="hljs-params"><span class="hljs-keyword">address</span> to, <span class="hljs-keyword">uint256</span> itemId</span>) <span class="hljs-title"><span class="hljs-keyword">public</span></span> <span class="hljs-title">onlyRole</span>(<span class="hljs-params">MINTER_ROLE</span>) <span class="hljs-title">whenNotPaused</span> </span>{
    <span class="hljs-comment">//////////////////////////////////////////</span>
    <span class="hljs-comment">// @audit: Call Soulbound1155.mint()</span>
    <span class="hljs-comment">//////////////////////////////////////////</span>
    ISoulbound1155(itemsNFTAddress).mint(to, itemId, <span class="hljs-number">1</span>, <span class="hljs-literal">true</span>);
    <span class="hljs-keyword">if</span> (itemId <span class="hljs-operator">=</span><span class="hljs-operator">=</span> _specialItemId) {
        <span class="hljs-keyword">emit</span> SpecialItemMinted(itemId, to, itemsNFTAddress);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">emit</span> ItemMinted(itemId, to, itemsNFTAddress);
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mintRandomItem</span>(<span class="hljs-params"><span class="hljs-keyword">address</span> to</span>) <span class="hljs-title"><span class="hljs-keyword">internal</span></span> <span class="hljs-title">onlyRole</span>(<span class="hljs-params">MINTER_ROLE</span>) <span class="hljs-title">whenNotPaused</span> </span>{
    <span class="hljs-comment">// Do randomness here to mint a random item between the id 1 and 26</span>
    <span class="hljs-keyword">uint256</span> random <span class="hljs-operator">=</span> <span class="hljs-keyword">uint256</span>(<span class="hljs-built_in">keccak256</span>(<span class="hljs-built_in">abi</span>.<span class="hljs-built_in">encodePacked</span>(<span class="hljs-built_in">block</span>.<span class="hljs-built_in">timestamp</span>, <span class="hljs-built_in">block</span>.<span class="hljs-built_in">difficulty</span>, to)));
    <span class="hljs-keyword">uint256</span> randomItem <span class="hljs-operator">=</span> random <span class="hljs-operator">%</span> <span class="hljs-number">26</span>;
    <span class="hljs-comment">//////////////////////////////////////////</span>
    <span class="hljs-comment">// @audit: Call Soulbound1155.mint()</span>
    <span class="hljs-comment">//////////////////////////////////////////</span>
    ISoulbound1155(itemsNFTAddress).mint(to, randomItem, <span class="hljs-number">1</span>, <span class="hljs-literal">false</span>);
    <span class="hljs-keyword">emit</span> RandomItemMinted(randomItem, to, itemsNFTAddress);
}
</code></pre><p><span>However, presented calls can’t work and will always result in revert, since number of arguments and types of arguments provided to </span><code>Soulbound1155.mint(...)</code><span> do not match the implementation. Consider the difference presented below:</span></p><ul>
<li><span>call from </span><code>AvatarBoundV1</code></li>
</ul><pre><code class="solidity hljs">mint(<span class="hljs-keyword">address</span> to, <span class="hljs-keyword">uint256</span> id, <span class="hljs-keyword">uint256</span> amount, <span class="hljs-keyword">bool</span> soulbound)
</code></pre><ul>
<li><span>implementation in </span><code>Soulbound1155</code></li>
</ul><pre><code class="solidity hljs">mint(<span class="hljs-keyword">uint256</span> id, <span class="hljs-keyword">uint256</span> amount, <span class="hljs-keyword">bool</span> soulbound, <span class="hljs-keyword">uint256</span> nonce, <span class="hljs-keyword">bytes</span> <span class="hljs-keyword">memory</span> signature)
</code></pre><p><strong><span>Recommendation(s)</span></strong><span>: Consider using </span><code>adminMint(...)</code><span> to mint </span><code>Soulbound1155</code><span> tokens.</span></p><p><strong><span>Status</span></strong><span>: Unresolved</span></p><p><strong><span>Update from the client</span></strong><span>:</span></p><hr><h3 id="Critical-Everyone-can-call-burn-and-burnBatch-with-an-arbitrary-address" data-id="Critical-Everyone-can-call-burn-and-burnBatch-with-an-arbitrary-address"><a class="anchor hidden-xs" href="#Critical-Everyone-can-call-burn-and-burnBatch-with-an-arbitrary-address" title="Critical-Everyone-can-call-burn-and-burnBatch-with-an-arbitrary-address"><span class="octicon octicon-link"></span></a><span>[Critical] Everyone can call </span><code>burn(...)</code><span> and </span><code>burnBatch(...)</code><span> with an arbitrary address</span></h3><p><strong><span>File(s)</span></strong><span>: </span><a href="" target="_blank" rel="noopener"><code>SoulBound1155.sol</code></a></p><p><strong><span>Description</span></strong><span>: </span><code>SoulBound1155.sol</code><span> is implementing a burning mechanism. Initially, it is inheriting the openzeppelin extension </span><code>ERC1155Burnable</code><span>.</span></p><p><span>However, this functionality was changed because before burning any soulbound token. It needs to update the </span><code>_soulbounds</code><span> mapping. This is done by the modifier </span><code>syncSoulBound(...)</code><span>.</span></p><p><span>But because of these changes, the issue arose, as now the functions for burning can be called by anyone with an arbitrary address. This leads to the burning of any token without approval from the token owner.</span></p><pre><code class="Solidity hljs"> <span class="hljs-keyword">function</span> burn(address <span class="hljs-keyword">to</span>, uint256 tokenId, uint256 amount) public <span class="hljs-keyword">virtual</span> override sync<span class="hljs-constructor">Soulbound(<span class="hljs-params">to</span>, <span class="hljs-params">tokenId</span>, <span class="hljs-params">amount</span>)</span> {
        <span class="hljs-constructor">_burn(<span class="hljs-params">to</span>, <span class="hljs-params">tokenId</span>, <span class="hljs-params">amount</span>)</span>;
    }

    <span class="hljs-keyword">function</span> burn<span class="hljs-constructor">Batch(<span class="hljs-params">address</span> <span class="hljs-params">to</span>, <span class="hljs-params">uint256</span>[] <span class="hljs-params">memory</span> <span class="hljs-params">tokenIds</span>, <span class="hljs-params">uint256</span>[] <span class="hljs-params">memory</span> <span class="hljs-params">amounts</span>)</span> public <span class="hljs-keyword">virtual</span> override sync<span class="hljs-constructor">BatchSoulbound(<span class="hljs-params">to</span>, <span class="hljs-params">tokenIds</span>, <span class="hljs-params">amounts</span>)</span> {
        <span class="hljs-constructor">_burnBatch(<span class="hljs-params">to</span>, <span class="hljs-params">tokenIds</span>, <span class="hljs-params">amounts</span>)</span>;
    }
</code></pre><p><span>The following test prooves this behaviour:</span></p><pre><code class="Solidity hljs"> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testBurn</span>(<span class="hljs-params"></span>) <span class="hljs-title"><span class="hljs-keyword">public</span></span></span>{
        <span class="hljs-keyword">address</span> alice <span class="hljs-operator">=</span> makeAddr(<span class="hljs-string">"alice"</span>);
        <span class="hljs-keyword">address</span> bob <span class="hljs-operator">=</span> makeAddr(<span class="hljs-string">"bob"</span>);
        soulbound1155.adminMint(alice, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">false</span>);
        soulbound1155.adminMint(bob, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">false</span>);
        vm.prank(bob);
        soulbound1155.burn(alice, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
        <span class="hljs-built_in">require</span>(soulbound1155.balanceOf(alice, <span class="hljs-number">1</span>) <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-number">0</span>);

    }
</code></pre><p><strong><span>Recommendation(s)</span></strong><span>: To mitigate this issue, implement necessary access control or call the burn function from the inherited contract.</span></p><p><strong><span>Status</span></strong><span>: Unresolved</span></p><p><strong><span>Update from the client</span></strong><span>:</span></p><hr><h3 id="High-Collisions-of-random-items" data-id="High-Collisions-of-random-items"><a class="anchor hidden-xs" href="#High-Collisions-of-random-items" title="High-Collisions-of-random-items"><span class="octicon octicon-link"></span></a><span>[High] Collisions of random items</span></h3><p><strong><span>File(s)</span></strong><span>: </span><a href="https://github.com/NethermindEth/NM-0151-Security-Review-ZkSync-Libertas/blob/b82b37ddad2f35fe7f6697a2a10407078a552ea3/achievo-contracts/contracts/upgradeables/AvatarBoundV1.sol#L175-L179" target="_blank" rel="noopener"><code>AvatarBoundV1.sol</code></a></p><p><strong><span>Description</span></strong><span>: During a call of </span><code>mintAvatarNftGating(...)</code><span> and </span><code>mintAvatar(...)</code><span> is called </span><code>mintRandomItem(...)</code><span> when the </span><code>mintRandomItemEnabled</code><span> is set to true.</span></p><p><span>When enabled, it calls the minting function within the contract </span><code>SoulBound1155.sol</code><span>, which mints one token with a random ID to the user. However, when the receiver of the token is already an owner of a specific ID, the minting functionality will revert.</span></p><p><span>Several issues arise when this random functionality is enabled, which leads to the reverting of the minting avatar functionality. The first main issue is related to the situation that </span><code>mintRandomItem(...)</code><span> is called within the loop. Probably, the wanted functionality was to mint several random items.</span></p><pre><code class="Solidity hljs">   <span class="hljs-keyword">if</span> (mintRandomItemEnabled) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">uint256</span> i <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i <span class="hljs-operator">&lt;</span> randomItemMints; i<span class="hljs-operator">+</span><span class="hljs-operator">+</span>) {
                mintRandomItem(_msgSender());
            }
        }
</code></pre><p><span>However, the random value in one transaction will be the same for all calls of </span><code>mintRandomItem(_msgSender())</code><span>. Therefore, the ID of the random item will be the same, and the minting will revert on the second call.</span></p><p><span>Even if this issue is solved by adding additional randomness to have different random values per every call of this function. The ID of the item is calculated by the following operation:</span></p><pre><code class="Solidty hljs"><span class="hljs-keyword">uint256</span> randomItem <span class="hljs-operator">=</span> random <span class="hljs-operator">%</span> <span class="hljs-number">26</span>;
</code></pre><p><span>The spread of random values is just 26, which is not a lot, and even if the </span><code>random</code><span> is different per every call, there is a high chance of the same ID result, which will revert again.</span></p><p><span>In conclusion, it is also necessary to mitigate the fact that the random ID can not be the same as </span><code>_specialItemId</code><span> or </span><code>defaultItemId</code><span>.</span><br>
<strong><span>Recommendation(s)</span></strong><span>:</span></p><p><strong><span>Status</span></strong><span>: Unresolved</span></p><p><strong><span>Update from the client</span></strong><span>:</span></p><hr><h3 id="High-The-function-mintAvatarNftGating-will-always-revert" data-id="High-The-function-mintAvatarNftGating-will-always-revert"><a class="anchor hidden-xs" href="#High-The-function-mintAvatarNftGating-will-always-revert" title="High-The-function-mintAvatarNftGating-will-always-revert"><span class="octicon octicon-link"></span></a><span>[High] The function </span><code>mintAvatarNftGating(...)</code><span> will always revert</span></h3><p><strong><span>File(s)</span></strong><span>: </span><a href="https://github.com/NethermindEth/NM-0151-Security-Review-ZkSync-Libertas/blob/b82b37ddad2f35fe7f6697a2a10407078a552ea3/achievo-contracts/contracts/upgradeables/AvatarBoundV1.sol#L197-L216" target="_blank" rel="noopener"><code>AvatarBoundV1.sol</code></a></p><p><strong><span>Description</span></strong><span>:  The function </span><code>mintAvatarNftGating(...)</code><span> will mint AvatarBound NFT to the caller who is an owner of NFT gating. Furthermore, to be able to call this function, a caller needs to present in the mapping </span><code>whitelistSigners</code><span>.</span></p><p><span>However, even though the caller meets the requirements above, the function will still revert because the function </span><code>revealNFTGatingToken(...)</code><span>. This function implements </span><code>onlyRole(MINTER_ROLE)</code><span>, which checks if the caller has this role. This role will probably not be used for the whitelist users. Therefore, the function will revert as a result of the missing role.</span></p><pre><code class="Solidity hljs">   <span class="hljs-keyword">function</span> reveal<span class="hljs-constructor">NFTGatingToken(<span class="hljs-params">uint256</span> <span class="hljs-params">tokenId</span>)</span> public only<span class="hljs-constructor">Role(MINTER_ROLE)</span> whenNotPaused { <span class="hljs-comment">//@audit-issue reverts for whitelist users</span>
        <span class="hljs-constructor">IOpenMint(<span class="hljs-params">gatingNFTAddress</span>)</span>.reveal(tokenId, revealURI);
        emit <span class="hljs-constructor">NFTRevealed(<span class="hljs-params">tokenId</span>, <span class="hljs-params">_msgSender</span>()</span>, gatingNFTAddress);
    }
</code></pre><p><span>Furthermore, it is possible to find the same issue for the functions </span><code>mintItem(...)</code><span> and </span><code>mintRandomItem(...)</code><span> as they also implement the same modifier as the function above. This will lead to reverting the function </span><code>mintAvatar(...)</code><span> when the minting of a random item or default item is enabled.</span></p><p><strong><span>Recommendation(s)</span></strong><span>: Split the functionality for the minter and whitelist user.</span></p><p><strong><span>Status</span></strong><span>: Unresolved</span></p><p><strong><span>Update from the client</span></strong><span>:</span></p><hr><h3 id="High-Incorrect-check-for-soulbound-tokens-transfers" data-id="High-Incorrect-check-for-soulbound-tokens-transfers"><a class="anchor hidden-xs" href="#High-Incorrect-check-for-soulbound-tokens-transfers" title="High-Incorrect-check-for-soulbound-tokens-transfers"><span class="octicon octicon-link"></span></a><span>[High] Incorrect check for soulbound tokens transfers</span></h3><p><strong><span>File(s)</span></strong><span>: </span><a href="" target="_blank" rel="noopener"><code>SoulBound1155.sol</code></a></p><p><strong><span>Description</span></strong><span>: The </span><code>SoulBound1155</code><span> contract allows to mint ERC1155 tokens. The tokens can be soulbounded to specific user address during minting, meaning those users should not be able to transfer those tokens. The same tokens can be minted to another user as non-soulbounded tokens, meaning that this user can transfer tokens. Whether the token is soulbounded to specific user address is defined in the </span><code>mint(...)</code><span> function by parameter </span><code>soulBound</code><span> and registered with the function </span><code>_soulbound(...)</code><span>. The ability to transfer tokens, is checked during a call to </span><code>safeTransferFrom(...)</code><span> in the modifier </span><code>soulboundCheck(...)</code><span>. The modifier calls </span><code>_checkMultipleAmounts(...)</code><span> function, which first checks if </span><code>from</code><span> or </span><code>to</code><span> addresses are whitelisted, and allows transfer if so, regardless of whether the token is a soulbound to the </span><code>from</code><span> address. Next, the function performs those two checks:</span></p><pre><code class="solidity hljs"><span class="hljs-keyword">if</span> (_soulbounds[<span class="hljs-keyword">from</span>][tokenId] <span class="hljs-operator">&gt;</span> amount) {
    <span class="hljs-keyword">revert</span>(<span class="hljs-string">"ERCSoulbound: The amount of soulbounded tokens is more than the amount of tokens to be transferred"</span>);
}

<span class="hljs-keyword">if</span> (_soulbounds[<span class="hljs-keyword">from</span>][tokenId] <span class="hljs-operator">=</span><span class="hljs-operator">=</span> amount) {
    <span class="hljs-keyword">revert</span>(<span class="hljs-string">"ERCSoulbound: The amount of soulbounded tokens is equal to the amount of tokens to be transferred"</span>);
}
</code></pre><p><span>Those checks revert if the amount of soulbounded tokens held by the </span><code>from</code><span> address is greater or equal to the transferred tokens. However, those checks still allow the sender to send the soulbounded tokens if the </span><code>amount</code><span> is higher than the amount of soulbounded tokens. This scenario is possible if the user that holds soulbounded tokens receives tokens with the same </span><code>id</code><span> from another user (who can send them). Consider this scenario:</span></p><ul>
<li><span>Bob holds one soulbound token id=1</span></li>
<li><span>Alice holds 1 non-soulbound token id=1</span></li>
<li><span>Alice transfers 1 token id=1 to Bob</span></li>
<li><span>Bob is able to tranfer 2 tokens id=1 (including the soulbound one) since </span><code>_soulbounds[Bob][1] &lt; 2</code></li>
</ul><p><span>Presented scenario allows for breaking the core functionality of soulbounded tokens i.e. non-transferrability.</span></p><p><strong><span>Recommendation(s)</span></strong><span>: Ensure that the tokens soulbounded to the user address are non-transferrable.</span></p><p><strong><span>Status</span></strong><span>: Unresolved</span></p><p><strong><span>Update from the client</span></strong><span>:</span></p><hr><h3 id="High-Soulbound1155-soulbound-tokens-transfer-on-mint" data-id="High-Soulbound1155-soulbound-tokens-transfer-on-mint"><a class="anchor hidden-xs" href="#High-Soulbound1155-soulbound-tokens-transfer-on-mint" title="High-Soulbound1155-soulbound-tokens-transfer-on-mint"><span class="octicon octicon-link"></span></a><span>[High] </span><code>Soulbound1155</code><span> soulbound tokens transfer on mint</span></h3><p><strong><span>File(s)</span></strong><span>: </span><a href="" target="_blank" rel="noopener"><code>SoulBound1155.sol</code></a></p><p><strong><span>Description</span></strong><span>: The </span><code>SoulBound1155</code><span> tokens can be soulbounded to specific address during mint, what means that this address should not be able to transfer those tokens. However, the token receiver may transfer the token during mint by reentering the </span><code>SoulBound1155</code><span>. The </span><code>__mint(...)</code><span> function mints a token, and after the mint it registers </span><code>soulbound</code><span>, as presented below:</span></p><pre><code class="solidity hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__mint</span>(<span class="hljs-params"><span class="hljs-keyword">address</span> to, <span class="hljs-keyword">uint256</span> id, <span class="hljs-keyword">uint256</span> amount, <span class="hljs-keyword">bool</span> soulbound</span>) <span class="hljs-title"><span class="hljs-keyword">private</span></span> </span>{
    isMinted[id][to] <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
    _mint(to, id, amount, <span class="hljs-string">""</span>);
    <span class="hljs-keyword">if</span> (soulbound) {
        _soulbound(to, id, amount);
    }
}
</code></pre><p><span>The </span><code>_mint(...)</code><span> function is inherited from the OpenZeppelin’s </span><code>ERC1155</code><span> contract. We present part of the function below:</span></p><pre><code class="solidity hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_mint</span>(<span class="hljs-params"><span class="hljs-keyword">address</span> to, <span class="hljs-keyword">uint256</span> id, <span class="hljs-keyword">uint256</span> amount, <span class="hljs-keyword">bytes</span> <span class="hljs-keyword">memory</span> data</span>) <span class="hljs-title"><span class="hljs-keyword">internal</span></span> <span class="hljs-title"><span class="hljs-keyword">virtual</span></span> </span>{
    
    <span class="hljs-comment">/////////////////////////</span>
    <span class="hljs-comment">// REST OF THE FUNCTION WAS CUT OUT</span>
    <span class="hljs-comment">/////////////////////////</span>
    
    _doSafeTransferAcceptanceCheck(operator, <span class="hljs-keyword">address</span>(<span class="hljs-number">0</span>), to, id, amount, data);
}
</code></pre><p><span>The </span><code>ERC1155._mint(...)</code><span> function calls at the end </span><code>_doSafeTransferAcceptanceCheck(...)</code><span> function which checks that the receiver is </span><code>ERC1155Receiver</code><span>, if it’s a contract. We present the function below:</span></p><pre><code class="solidity hljs">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_doSafeTransferAcceptanceCheck</span>(<span class="hljs-params">
      <span class="hljs-keyword">address</span> operator,
      <span class="hljs-keyword">address</span> <span class="hljs-keyword">from</span>,
      <span class="hljs-keyword">address</span> to,
      <span class="hljs-keyword">uint256</span> id,
      <span class="hljs-keyword">uint256</span> amount,
      <span class="hljs-keyword">bytes</span> <span class="hljs-keyword">memory</span> data
  </span>) <span class="hljs-title"><span class="hljs-keyword">private</span></span> </span>{
      <span class="hljs-keyword">if</span> (to.isContract()) {
          <span class="hljs-keyword">try</span> IERC1155Receiver(to).onERC1155Received(operator, <span class="hljs-keyword">from</span>, id, amount, data) <span class="hljs-keyword">returns</span> (<span class="hljs-keyword">bytes4</span> response) {
              <span class="hljs-keyword">if</span> (response <span class="hljs-operator">!</span><span class="hljs-operator">=</span> IERC1155Receiver.onERC1155Received.<span class="hljs-built_in">selector</span>) {
                  <span class="hljs-keyword">revert</span>(<span class="hljs-string">"ERC1155: ERC1155Receiver rejected tokens"</span>);
              }
          } <span class="hljs-keyword">catch</span> <span class="hljs-built_in">Error</span>(<span class="hljs-keyword">string</span> <span class="hljs-keyword">memory</span> reason) {
              <span class="hljs-keyword">revert</span>(reason);
          } <span class="hljs-keyword">catch</span> {
              <span class="hljs-keyword">revert</span>(<span class="hljs-string">"ERC1155: transfer to non-ERC1155Receiver implementer"</span>);
          }
      }
  }
</code></pre><p><span>The function </span><code>_doSafeTransferAcceptanceCheck(...)</code><span> does external call to the receiver </span><code>IERC1155Receiver(to).onERC1155Received(operator, from, ids, amounts, data)</code><span> to check if the response is correct function signature. However, malicious receiver can be a contract that implements </span><code>onERC1155Received(...)</code><span> in a way that allows to reenter </span><code>Soulbound1155</code><span> contract and transfer minted token to another address. Below we present an example of such malicious receiver contract:</span></p><pre><code class="solidity hljs"><span class="hljs-class"><span class="hljs-keyword">contract</span> <span class="hljs-title">ReentrancyAttacker</span> </span>{
    Soulbound1155 soulbound;
    <span class="hljs-keyword">address</span> otherTrustedAddress;

    <span class="hljs-function"><span class="hljs-keyword">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">address</span> _soulbound, <span class="hljs-keyword">address</span> _otherTrustedAddress</span>) </span>{
        soulbound <span class="hljs-operator">=</span> Soulbound1155(_soulbound);
        otherTrustedAddress <span class="hljs-operator">=</span> _otherTrustedAddress;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onERC1155Received</span>(<span class="hljs-params"><span class="hljs-keyword">address</span> operator, <span class="hljs-keyword">address</span> <span class="hljs-keyword">from</span>, <span class="hljs-keyword">uint256</span> id, <span class="hljs-keyword">uint256</span> amount, <span class="hljs-keyword">bytes</span> <span class="hljs-keyword">calldata</span> data</span>) <span class="hljs-title"><span class="hljs-keyword">public</span></span> <span class="hljs-title"><span class="hljs-keyword">returns</span></span> (<span class="hljs-params"><span class="hljs-keyword">bytes4</span> response</span>) </span>{
        <span class="hljs-comment">/////////////////////////</span>
        <span class="hljs-comment">// @audit: Receiver reenters Soulbound1155 and calls safeTransferFrom</span>
        <span class="hljs-comment">/////////////////////////</span>
        soulbound.safeTransferFrom(<span class="hljs-keyword">address</span>(<span class="hljs-built_in">this</span>), otherTrustedAddress, id, amount, <span class="hljs-string">hex""</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.onERC1155Received.<span class="hljs-built_in">selector</span>;
    }

}
</code></pre><p><span>Consider following scenario, where the malicious receiver is the contract presented above:</span></p><ul>
<li><span>Minter mints the soulbound token id=1 for the malicious receiver</span></li>
<li><span>On mint, the malicious receiver sends the token to another address that they hold (address B)</span></li>
<li><span>Address B is now holding non-soulbound token and is able to transfer it</span></li>
</ul><p><span>Described scenario is possible because the contract </span><code>Soulbound1155</code><span> can be reentered during mint. Note, that this issue applies not only to </span><code>__mint(...)</code><span> but also to </span><code>__mintBatch(...)</code><span>.</span></p><p><strong><span>Recommendation(s)</span></strong><span>: Consider adding reentrancy guard to the </span><code>Soulbound1155</code><span> contract.</span></p><p><strong><span>Status</span></strong><span>: Unresolved</span></p><p><strong><span>Update from the client</span></strong><span>:</span></p><hr><h3 id="High-AvatarBoundV1-soulbound-tokens-transfer-on-mint" data-id="High-AvatarBoundV1-soulbound-tokens-transfer-on-mint"><a class="anchor hidden-xs" href="#High-AvatarBoundV1-soulbound-tokens-transfer-on-mint" title="High-AvatarBoundV1-soulbound-tokens-transfer-on-mint"><span class="octicon octicon-link"></span></a><span>[High] </span><code>AvatarBoundV1</code><span> soulbound tokens transfer on mint</span></h3><p><strong><span>File(s)</span></strong><span>: </span><a href="" target="_blank" rel="noopener"><code>AvatarBoundV1.sol</code></a></p><p><strong><span>Description</span></strong><span>: The </span><code>AvatarBoundV1</code><span> is an ERC712 soulbound token. The address for which this token is minted should not be able to transfer it. However, malicious receiver, during the safe mint may reenter the </span><code>AvatarBoundV1</code><span> and call </span><code>AvatarBoundV1.transferFrom(...)</code><span> to transfer the token to another address (A). This not only breaks soulbound property of the receiver, but also the new address A is able to transfer the token further. The issue exists because the function </span><code>mint(...)</code><span> calls inherited from </span><code>ERC721Upgradeable</code><span> function </span><code>_safeMint(...)</code><span>, presented below:</span></p><pre><code class="solidity hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_safeMint</span>(<span class="hljs-params"><span class="hljs-keyword">address</span> to, <span class="hljs-keyword">uint256</span> tokenId, <span class="hljs-keyword">bytes</span> <span class="hljs-keyword">memory</span> data</span>) <span class="hljs-title"><span class="hljs-keyword">internal</span></span> <span class="hljs-title"><span class="hljs-keyword">virtual</span></span> </span>{
    _mint(to, tokenId);
    <span class="hljs-built_in">require</span>(
        _checkOnERC721Received(<span class="hljs-keyword">address</span>(<span class="hljs-number">0</span>), to, tokenId, data),
        <span class="hljs-string">"ERC721: transfer to non ERC721Receiver implementer"</span>
    );
}
</code></pre><p><span>This function checks if the receiver is correct ERC721Receiver with </span><code>_checkOnERC721Received(...)</code><span>:</span></p><pre><code class="solidity hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_checkOnERC721Received</span>(<span class="hljs-params">
    <span class="hljs-keyword">address</span> <span class="hljs-keyword">from</span>,
    <span class="hljs-keyword">address</span> to,
    <span class="hljs-keyword">uint256</span> tokenId,
    <span class="hljs-keyword">bytes</span> <span class="hljs-keyword">memory</span> data
</span>) <span class="hljs-title"><span class="hljs-keyword">private</span></span> <span class="hljs-title"><span class="hljs-keyword">returns</span></span> (<span class="hljs-params"><span class="hljs-keyword">bool</span></span>) </span>{
    <span class="hljs-keyword">if</span> (to.isContract()) {
        <span class="hljs-keyword">try</span> IERC721ReceiverUpgradeable(to).onERC721Received(_msgSender(), <span class="hljs-keyword">from</span>, tokenId, data) <span class="hljs-keyword">returns</span> (<span class="hljs-keyword">bytes4</span> retval) {
            <span class="hljs-keyword">return</span> retval <span class="hljs-operator">=</span><span class="hljs-operator">=</span> IERC721ReceiverUpgradeable.onERC721Received.<span class="hljs-built_in">selector</span>;
        } <span class="hljs-keyword">catch</span> (<span class="hljs-keyword">bytes</span> <span class="hljs-keyword">memory</span> reason) {
            <span class="hljs-keyword">if</span> (reason.<span class="hljs-built_in">length</span> <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">revert</span>(<span class="hljs-string">"ERC721: transfer to non ERC721Receiver implementer"</span>);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">/// @solidity memory-safe-assembly</span>
                <span class="hljs-keyword">assembly</span> {
                    <span class="hljs-keyword">revert</span>(<span class="hljs-built_in">add</span>(<span class="hljs-number">32</span>, reason), <span class="hljs-built_in">mload</span>(reason))
                }
            }
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}
</code></pre><p><span>The check is done after the mint by performing external call to the receiver with </span><code>IERC721ReceiverUpgradeable(to).onERC721Received(...)</code><span>. Malicious receiver may be a contract, which reenters the </span><code>AvatarBoundV1</code><span> to transfer the token to another address.</span><br>
<span>Note that currently the </span><code>AvatarBoundV1</code><span> prohibits any token transfers by overriding </span><code>_beforeTokenTransfer(...)</code><span> with modifier </span><code>soulboundAddressCheck(from)</code><span>:</span></p><pre><code class="solidity hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_beforeTokenTransfer</span>(<span class="hljs-params">
    <span class="hljs-keyword">address</span> <span class="hljs-keyword">from</span>,
    <span class="hljs-keyword">address</span> to,
    <span class="hljs-keyword">uint256</span> tokenId,
    <span class="hljs-keyword">uint256</span> batch
</span>) <span class="hljs-title"><span class="hljs-keyword">internal</span></span> <span class="hljs-title"><span class="hljs-keyword">override</span></span>(<span class="hljs-params">ERC721Upgradeable, ERC721EnumerableUpgradeable</span>) <span class="hljs-title">soulboundAddressCheck</span>(<span class="hljs-params"><span class="hljs-keyword">from</span></span>) </span>{
    <span class="hljs-built_in">super</span>._beforeTokenTransfer(<span class="hljs-keyword">from</span>, to, tokenId, batch);
}
</code></pre><p><span>However, this check does not fix for the presented scenario, since in the address is registered as soulbound after the </span><code>_safeMint(...)</code><span> call, therefore the transfer during mint is still possible.</span></p><p><strong><span>Recommendation(s)</span></strong><span>: If the </span><code>AvatarBoundV1</code><span> tokens should not be transferrable, consider disabling transfer functions instead of adding a modifier to the </span><code>_beforeTokenTransfer(...)</code><span> hook.</span></p><p><strong><span>Status</span></strong><span>: Unresolved</span></p><p><strong><span>Update from the client</span></strong><span>:</span></p><hr><h3 id="High-Users-can-mint-any-amount-of-SoulBound1155-tokens" data-id="High-Users-can-mint-any-amount-of-SoulBound1155-tokens"><a class="anchor hidden-xs" href="#High-Users-can-mint-any-amount-of-SoulBound1155-tokens" title="High-Users-can-mint-any-amount-of-SoulBound1155-tokens"><span class="octicon octicon-link"></span></a><span>[High] Users can mint any amount of </span><code>SoulBound1155</code><span> tokens</span></h3><p><strong><span>File(s)</span></strong><span>: </span><a href="" target="_blank" rel="noopener"><code>SoulBound1155.sol</code></a></p><p><strong><span>Description</span></strong><span>: The caller of the </span><code>SoulBound1155.mintBatch(...)</code><span> is able to mint any arbitrary amount of tokens by passing to repeated values in the arrays </span><code>ids</code><span> and </span><code>amounts</code><span>. Below we present the modifier </span><code>canMintBatch(...)</code><span> that checks if the provided amount is correct:</span></p><pre><code class="solidity hljs"><span class="hljs-function"><span class="hljs-keyword">modifier</span> <span class="hljs-title">canMintBatch</span>(<span class="hljs-params">
    <span class="hljs-keyword">address</span> to,
    <span class="hljs-keyword">uint256</span>[] <span class="hljs-keyword">memory</span> tokenIds,
    <span class="hljs-keyword">uint256</span>[] <span class="hljs-keyword">memory</span> amounts
</span>) </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">uint256</span> i <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i <span class="hljs-operator">&lt;</span> tokenIds.<span class="hljs-built_in">length</span>; i<span class="hljs-operator">+</span><span class="hljs-operator">+</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-operator">!</span>tokenExists[tokenIds[i]]) {
            <span class="hljs-keyword">revert</span>(<span class="hljs-string">"Token not exist"</span>);
        }

        <span class="hljs-keyword">if</span> (isMinted[tokenIds[i]][to]) {
            <span class="hljs-keyword">revert</span>(<span class="hljs-string">"Already minted"</span>);
        }

        <span class="hljs-keyword">if</span> (amounts[i] <span class="hljs-operator">&gt;</span> MAX_PER_MINT) {
            <span class="hljs-keyword">revert</span>(<span class="hljs-string">"Exceed max mint"</span>);
        }
    }

    <span class="hljs-keyword">_</span>;
}
</code></pre><p><span>This modifier will iterate through each element of both arrays and check if the token was already minted to given address, and if the amount is less than </span><code>MAX_PER_MINT</code><span>. If provided arrays are e.g.: </span><code>ids=[1,1,1]</code><span>, </span><code>amounts=[1,1,1]</code><span>, then the checks in </span><code>canMintBatch(...)</code><span> modifier will pass, since token with </span><code>id=1</code><span> was not yet minted, and each value in </span><code>amounts</code><span> is correct. Those arrays are used in </span><code>ERC1155._mintBatch(...)</code><span> which in result mints to given address </span><code>amount=3</code><span> of token </span><code>id=1</code><span>. Note that this issue can be used to mint arbitrary amount for any set of token ids.</span></p><p><strong><span>Recommendation(s)</span></strong><span>: Consider restricting duplicates in modifier </span><code>canMintBatch(...)</code><span>.</span></p><p><strong><span>Status</span></strong><span>: Unresolved</span></p><p><strong><span>Update from the client</span></strong><span>:</span></p><hr></div>
    <div class="ui-toc dropup unselectable hidden-print" style="display:none;">
        <div class="pull-right dropdown">
            <a id="tocLabel" class="ui-toc-label btn btn-default" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false" title="Table of content">
                <i class="fa fa-bars"></i>
            </a>
            <ul id="ui-toc" class="ui-toc-dropdown dropdown-menu" aria-labelledby="tocLabel">
                <div class="toc"><ul class="nav">
<li><a href="#Critical-AvatarBoundV1-can’t-mint-Soulbound1155-tokens" title="[Critical] AvatarBoundV1 can’t mint Soulbound1155 tokens">[Critical] AvatarBoundV1 can’t mint Soulbound1155 tokens</a></li>
<li><a href="#Critical-Everyone-can-call-burn-and-burnBatch-with-an-arbitrary-address" title="[Critical] Everyone can call burn(...) and burnBatch(...) with an arbitrary address">[Critical] Everyone can call burn(...) and burnBatch(...) with an arbitrary address</a></li>
<li><a href="#High-Collisions-of-random-items" title="[High] Collisions of random items">[High] Collisions of random items</a></li>
<li><a href="#High-The-function-mintAvatarNftGating-will-always-revert" title="[High] The function mintAvatarNftGating(...) will always revert">[High] The function mintAvatarNftGating(...) will always revert</a></li>
<li><a href="#High-Incorrect-check-for-soulbound-tokens-transfers" title="[High] Incorrect check for soulbound tokens transfers">[High] Incorrect check for soulbound tokens transfers</a></li>
<li><a href="#High-Soulbound1155-soulbound-tokens-transfer-on-mint" title="[High] Soulbound1155 soulbound tokens transfer on mint">[High] Soulbound1155 soulbound tokens transfer on mint</a></li>
<li><a href="#High-AvatarBoundV1-soulbound-tokens-transfer-on-mint" title="[High] AvatarBoundV1 soulbound tokens transfer on mint">[High] AvatarBoundV1 soulbound tokens transfer on mint</a></li>
<li><a href="#High-Users-can-mint-any-amount-of-SoulBound1155-tokens" title="[High] Users can mint any amount of SoulBound1155 tokens">[High] Users can mint any amount of SoulBound1155 tokens</a></li>
</ul>
</div><div class="toc-menu"><a class="expand-toggle" href="#">Expand all</a><a class="back-to-top" href="#">Back to top</a><a class="go-to-bottom" href="#">Go to bottom</a></div>
            </ul>
        </div>
    </div>
    <div id="ui-toc-affix" class="ui-affix-toc ui-toc-dropdown unselectable hidden-print" data-spy="affix" style="top:17px;display:none;" null null>
        <div class="toc"><ul class="nav">
<li class=""><a href="#Critical-AvatarBoundV1-can’t-mint-Soulbound1155-tokens" title="[Critical] AvatarBoundV1 can’t mint Soulbound1155 tokens">[Critical] AvatarBoundV1 can’t mint Soulbound1155 tokens</a></li>
<li class=""><a href="#Critical-Everyone-can-call-burn-and-burnBatch-with-an-arbitrary-address" title="[Critical] Everyone can call burn(...) and burnBatch(...) with an arbitrary address">[Critical] Everyone can call burn(...) and burnBatch(...) with an arbitrary address</a></li>
<li class=""><a href="#High-Collisions-of-random-items" title="[High] Collisions of random items">[High] Collisions of random items</a></li>
<li class=""><a href="#High-The-function-mintAvatarNftGating-will-always-revert" title="[High] The function mintAvatarNftGating(...) will always revert">[High] The function mintAvatarNftGating(...) will always revert</a></li>
<li class=""><a href="#High-Incorrect-check-for-soulbound-tokens-transfers" title="[High] Incorrect check for soulbound tokens transfers">[High] Incorrect check for soulbound tokens transfers</a></li>
<li class=""><a href="#High-Soulbound1155-soulbound-tokens-transfer-on-mint" title="[High] Soulbound1155 soulbound tokens transfer on mint">[High] Soulbound1155 soulbound tokens transfer on mint</a></li>
<li class=""><a href="#High-AvatarBoundV1-soulbound-tokens-transfer-on-mint" title="[High] AvatarBoundV1 soulbound tokens transfer on mint">[High] AvatarBoundV1 soulbound tokens transfer on mint</a></li>
<li class=""><a href="#High-Users-can-mint-any-amount-of-SoulBound1155-tokens" title="[High] Users can mint any amount of SoulBound1155 tokens">[High] Users can mint any amount of SoulBound1155 tokens</a></li>
</ul>
</div><div class="toc-menu"><a class="expand-toggle" href="#">Expand all</a><a class="back-to-top" href="#">Back to top</a><a class="go-to-bottom" href="#">Go to bottom</a></div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gist-embed/2.6.0/gist-embed.min.js" integrity="sha256-KyF2D6xPIJUW5sUDSs93vWyZm+1RzIpKCexxElmxl8g=" crossorigin="anonymous" defer></script>
    <script>
        var markdown = $(".markdown-body");
        //smooth all hash trigger scrolling
        function smoothHashScroll() {
            var hashElements = $("a[href^='#']").toArray();
            for (var i = 0; i < hashElements.length; i++) {
                var element = hashElements[i];
                var $element = $(element);
                var hash = element.hash;
                if (hash) {
                    $element.on('click', function (e) {
                        // store hash
                        var hash = this.hash;
                        if ($(hash).length <= 0) return;
                        // prevent default anchor click behavior
                        e.preventDefault();
                        // animate
                        $('body, html').stop(true, true).animate({
                            scrollTop: $(hash).offset().top
                        }, 100, "linear", function () {
                            // when done, add hash to url
                            // (default click behaviour)
                            window.location.hash = hash;
                        });
                    });
                }
            }
        }

        smoothHashScroll();
        var toc = $('.ui-toc');
        var tocAffix = $('.ui-affix-toc');
        var tocDropdown = $('.ui-toc-dropdown');
        //toc
        tocDropdown.click(function (e) {
            e.stopPropagation();
        });

        var enoughForAffixToc = true;

        function generateScrollspy() {
            $(document.body).scrollspy({
                target: ''
            });
            $(document.body).scrollspy('refresh');
            if (enoughForAffixToc) {
                toc.hide();
                tocAffix.show();
            } else {
                tocAffix.hide();
                toc.show();
            }
            $(document.body).scroll();
        }

        function windowResize() {
            //toc right
            var paddingRight = parseFloat(markdown.css('padding-right'));
            var right = ($(window).width() - (markdown.offset().left + markdown.outerWidth() - paddingRight));
            toc.css('right', right + 'px');
            //affix toc left
            var newbool;
            var rightMargin = (markdown.parent().outerWidth() - markdown.outerWidth()) / 2;
            //for ipad or wider device
            if (rightMargin >= 133) {
                newbool = true;
                var affixLeftMargin = (tocAffix.outerWidth() - tocAffix.width()) / 2;
                var left = markdown.offset().left + markdown.outerWidth() - affixLeftMargin;
                tocAffix.css('left', left + 'px');
            } else {
                newbool = false;
            }
            if (newbool != enoughForAffixToc) {
                enoughForAffixToc = newbool;
                generateScrollspy();
            }
        }
        $(window).resize(function () {
            windowResize();
        });
        $(document).ready(function () {
            windowResize();
            generateScrollspy();
        });

        //remove hash
        function removeHash() {
            window.location.hash = '';
        }

        var backtotop = $('.back-to-top');
        var gotobottom = $('.go-to-bottom');

        backtotop.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToTop)
                scrollToTop();
            removeHash();
        });
        gotobottom.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToBottom)
                scrollToBottom();
            removeHash();
        });

        var toggle = $('.expand-toggle');
        var tocExpand = false;

        checkExpandToggle();
        toggle.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            tocExpand = !tocExpand;
            checkExpandToggle();
        })

        function checkExpandToggle () {
            var toc = $('.ui-toc-dropdown .toc');
            var toggle = $('.expand-toggle');
            if (!tocExpand) {
                toc.removeClass('expand');
                toggle.text('Expand all');
            } else {
                toc.addClass('expand');
                toggle.text('Collapse all');
            }
        }

        function scrollToTop() {
            $('body, html').stop(true, true).animate({
                scrollTop: 0
            }, 100, "linear");
        }

        function scrollToBottom() {
            $('body, html').stop(true, true).animate({
                scrollTop: $(document.body)[0].scrollHeight
            }, 100, "linear");
        }
    </script>
</body>

</html>
