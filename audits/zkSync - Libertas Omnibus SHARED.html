<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="mobile-web-app-capable" content="yes">
    <title>
        zkSync - Libertas Omnibus SHARED - HackMD
    </title>
    <link rel="icon" type="image/png" href="https://hackmd.io/favicon.png">
    <link rel="apple-touch-icon" href="https://hackmd.io/apple-touch-icon.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css" integrity="sha256-3iu9jgsy9TpTwXKb7bNQzqWekRX7pPK+2OLj3R922fo=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/octicons/3.5.0/octicons.min.css" integrity="sha256-QiWfLIsCT02Sdwkogf6YMiQlj4NE84MKkzEMkZnMGdg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.1/themes/prism.min.css" integrity="sha256-vtR0hSWRc3Tb26iuN2oZHt3KRUomwTufNIf5/4oeCyg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/css/basic/emojify.min.css" integrity="sha256-UOrvMOsSDSrW6szVLe8ZDZezBxh5IoIfgTwdNDgTjiU=" crossorigin="anonymous" />
    <style>
        @import url(https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i|Source+Code+Pro:300,400,500|Source+Sans+Pro:300,300i,400,400i,600,600i|Source+Serif+Pro&subset=latin-ext);.hljs{background:#fff;color:#333;display:block;overflow-x:auto;padding:.5em}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-string,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#a71d5d}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#0086b3}.hljs-built_in,.hljs-builtin-name{color:#005cc5}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#795da3}.hljs-addition{background-color:#eaffea;color:#55a532}.hljs-deletion{background-color:#ffecec;color:#bd2c00}.hljs-link{text-decoration:underline}.markdown-body{word-wrap:break-word;font-size:16px;line-height:1.5}.markdown-body:after,.markdown-body:before{content:"";display:table}.markdown-body:after{clear:both}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body .absent{color:#c00}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body blockquote,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-bottom:16px;margin-top:0}.markdown-body hr{background-color:#e7e7e7;border:0;height:.25em;margin:24px 0;padding:0}.markdown-body blockquote{border-left:.25em solid #ddd;color:#777;font-size:16px;padding:0 1em}.markdown-body blockquote>:first-child{margin-top:0}.markdown-body blockquote>:last-child{margin-bottom:0}.markdown-body kbd,.popover kbd{background-color:#fcfcfc;border:1px solid;border-color:#ccc #ccc #bbb;border-radius:3px;box-shadow:inset 0 -1px 0 #bbb;color:#555;display:inline-block;font-size:11px;line-height:10px;padding:3px 5px;vertical-align:middle}.markdown-body .loweralpha{list-style-type:lower-alpha}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:600;line-height:1.25;margin-bottom:16px;margin-top:24px}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#000;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1 code,.markdown-body h1 tt,.markdown-body h2 code,.markdown-body h2 tt,.markdown-body h3 code,.markdown-body h3 tt,.markdown-body h4 code,.markdown-body h4 tt,.markdown-body h5 code,.markdown-body h5 tt,.markdown-body h6 code,.markdown-body h6 tt{font-size:inherit}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{border-bottom:1px solid #eee;padding-bottom:.3em}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{color:#777;font-size:.85em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol.no-list,.markdown-body ul.no-list{list-style-type:none;padding:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-bottom:0;margin-top:0}.markdown-body li>p{margin-top:16px}.markdown-body li+li{padding-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{font-size:1em;font-style:italic;font-weight:700;margin-top:16px;padding:0}.markdown-body dl dd{margin-bottom:16px;padding:0 16px}.markdown-body table{display:block;overflow:auto;width:100%;word-break:normal;word-break:keep-all}.markdown-body table th{font-weight:700}.markdown-body table td,.markdown-body table th{border:1px solid #ddd;padding:6px 13px}.markdown-body table tr{background-color:#fff;border-top:1px solid #ccc}.markdown-body table tr:nth-child(2n){background-color:#f8f8f8}.markdown-body img{background-color:#fff;box-sizing:initial;max-width:100%}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body .emoji{background-color:initial;max-width:none;vertical-align:text-top}.markdown-body span.frame{display:block;overflow:hidden}.markdown-body span.frame>span{border:1px solid #ddd;display:block;float:left;margin:13px 0 0;overflow:hidden;padding:7px;width:auto}.markdown-body span.frame span img{display:block;float:left}.markdown-body span.frame span span{clear:both;color:#333;display:block;padding:5px 0 0}.markdown-body span.align-center{clear:both;display:block;overflow:hidden}.markdown-body span.align-center>span{display:block;margin:13px auto 0;overflow:hidden;text-align:center}.markdown-body span.align-center span img{margin:0 auto;text-align:center}.markdown-body span.align-right{clear:both;display:block;overflow:hidden}.markdown-body span.align-right>span{display:block;margin:13px 0 0;overflow:hidden;text-align:right}.markdown-body span.align-right span img{margin:0;text-align:right}.markdown-body span.float-left{display:block;float:left;margin-right:13px;overflow:hidden}.markdown-body span.float-left span{margin:13px 0 0}.markdown-body span.float-right{display:block;float:right;margin-left:13px;overflow:hidden}.markdown-body span.float-right>span{display:block;margin:13px auto 0;overflow:hidden;text-align:right}.markdown-body code,.markdown-body tt{background-color:#0000000a;border-radius:3px;font-size:85%;margin:0;padding:.2em 0}.markdown-body code:after,.markdown-body code:before,.markdown-body tt:after,.markdown-body tt:before{content:"\00a0";letter-spacing:-.2em}.markdown-body code br,.markdown-body tt br{display:none}.markdown-body del code{text-decoration:inherit}.markdown-body pre{word-wrap:normal}.markdown-body pre>code{background:#0000;border:0;font-size:100%;margin:0;padding:0;white-space:pre;word-break:normal}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{border-radius:3px;font-size:85%;line-height:1.45;overflow:auto}.markdown-body:not(.next-editor) pre{background-color:#f7f7f7;padding:16px}.markdown-body pre code,.markdown-body pre tt{word-wrap:normal;background-color:initial;border:0;display:inline;line-height:inherit;margin:0;max-width:auto;overflow:visible;padding:0}.markdown-body pre code:after,.markdown-body pre code:before,.markdown-body pre tt:after,.markdown-body pre tt:before{content:normal}.markdown-body .csv-data td,.markdown-body .csv-data th{font-size:12px;line-height:1;overflow:hidden;padding:5px;text-align:left;white-space:nowrap}.markdown-body .csv-data .blob-line-num{background:#fff;border:0;padding:10px 8px 9px;text-align:right}.markdown-body .csv-data tr{border-top:0}.markdown-body .csv-data th{background:#f8f8f8;border-top:0;font-weight:700}.news .alert .markdown-body blockquote{border:0;padding:0 0 0 40px}.activity-tab .news .alert .commits,.activity-tab .news .markdown-body blockquote{padding-left:0}.task-list-item{list-style-type:none}.task-list-item label{font-weight:400}.task-list-item.enabled label{cursor:pointer}.task-list-item+.task-list-item{margin-top:3px}.task-list-item-checkbox{cursor:default!important;float:left;margin:.31em 0 .2em -1.3em!important;vertical-align:middle}.markdown-body{max-width:758px;overflow:visible!important;padding-bottom:40px;padding-top:40px;position:relative}.markdown-body.next-editor{overflow-x:hidden!important}.markdown-body .emoji{vertical-align:top}.markdown-body pre{border:inherit!important}.markdown-body code{color:inherit!important}.markdown-body pre code .wrapper{display:-moz-inline-flex;display:-ms-inline-flex;display:-o-inline-flex;display:inline-flex}.markdown-body pre code .gutter{float:left;overflow:hidden;-webkit-user-select:none;user-select:none}.markdown-body pre code .gutter.linenumber{border-right:3px solid #6ce26c!important;box-sizing:initial;color:#afafaf!important;cursor:default;display:inline-block;min-width:20px;padding:0 8px 0 0;position:relative;text-align:right;z-index:4}.markdown-body pre code .gutter.linenumber>span:before{content:attr(data-linenumber)}.markdown-body pre code .code{float:left;margin:0 0 0 16px}.markdown-body .gist .line-numbers{border-bottom:none;border-left:none;border-top:none}.markdown-body .gist .line-data{border:none}.markdown-body .gist table{border-collapse:inherit!important;border-spacing:0}.markdown-body code[data-gist-id]{background:none;padding:0}.markdown-body code[data-gist-id]:after,.markdown-body code[data-gist-id]:before{content:""}.markdown-body code[data-gist-id] .blob-num{border:unset}.markdown-body code[data-gist-id] table{margin-bottom:unset;overflow:unset}.markdown-body code[data-gist-id] table tr{background:unset}.markdown-body[dir=rtl] pre{direction:ltr}.markdown-body[dir=rtl] code{direction:ltr;unicode-bidi:embed}.markdown-body .alert{display:flex;flex-direction:column;gap:16px}.markdown-body .alert>*{margin:0}.markdown-body pre.abc,.markdown-body pre.flow-chart,.markdown-body pre.graphviz,.markdown-body pre.mermaid,.markdown-body pre.sequence-diagram,.markdown-body pre.vega{background-color:inherit;border-radius:0;overflow:visible;text-align:center;white-space:inherit}.markdown-body pre.abc>code,.markdown-body pre.flow-chart>code,.markdown-body pre.graphviz>code,.markdown-body pre.mermaid>code,.markdown-body pre.sequence-diagram>code,.markdown-body pre.vega>code{text-align:left}.markdown-body pre.abc>svg,.markdown-body pre.flow-chart>svg,.markdown-body pre.graphviz>svg,.markdown-body pre.mermaid>svg,.markdown-body pre.sequence-diagram>svg,.markdown-body pre.vega>svg{height:100%;max-width:100%}.markdown-body pre>code.wrap{word-wrap:break-word;white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap}.markdown-body summary{display:list-item}.markdown-body summary:focus{outline:none}.markdown-body details summary{cursor:pointer}.markdown-body details:not([open])>:not(summary){display:none}.markdown-body figure{margin:1em 40px}.markdown-body .mark,.markdown-body mark{background-color:#fff1a7}.vimeo,.youtube{background-color:#000;background-position:50%;background-repeat:no-repeat;background-size:contain;cursor:pointer;display:table;overflow:hidden;text-align:center}.vimeo,.youtube{position:relative;width:100%}.youtube{padding-bottom:56.25%}.vimeo img{object-fit:contain;width:100%;z-index:0}.youtube img{object-fit:cover;z-index:0}.vimeo iframe,.youtube iframe,.youtube img{height:100%;left:0;position:absolute;top:0;width:100%}.vimeo iframe,.youtube iframe{vertical-align:middle;z-index:1}.vimeo .icon,.youtube .icon{color:#fff;height:auto;left:50%;opacity:.3;position:absolute;top:50%;transform:translate(-50%,-50%);transition:opacity .2s;width:auto;z-index:0}.vimeo:hover .icon,.youtube:hover .icon{opacity:.6;transition:opacity .2s}.slideshare .inner,.speakerdeck .inner{position:relative;width:100%}.slideshare .inner iframe,.speakerdeck .inner iframe{bottom:0;height:100%;left:0;position:absolute;right:0;top:0;width:100%}.figma{display:table;padding-bottom:56.25%;position:relative;width:100%}.figma iframe{border:1px solid #eee;bottom:0;height:100%;left:0;position:absolute;right:0;top:0;width:100%}.markmap-container{height:300px}.markmap-container>svg{height:100%;width:100%}.MJX_Assistive_MathML{display:none}#MathJax_Message{z-index:1000!important}.ui-infobar{color:#777;margin:25px auto -25px;max-width:760px;position:relative;z-index:2}.toc .invisable-node{list-style-type:none}.ui-toc{bottom:20px;position:fixed;z-index:998}.ui-toc.both-mode{margin-left:8px}.ui-toc.both-mode .ui-toc-label{border-bottom-left-radius:0;border-top-left-radius:0;height:40px;padding:10px 4px}.ui-toc-label{background-color:#e6e6e6;border:none;color:#868686;transition:opacity .2s}.ui-toc .open .ui-toc-label{color:#fff;opacity:1;transition:opacity .2s}.ui-toc-label:focus{background-color:#ccc;color:#000;opacity:.3}.ui-toc-label:hover{background-color:#ccc;opacity:1;transition:opacity .2s}.ui-toc-dropdown{margin-bottom:20px;margin-top:20px;max-height:70vh;max-width:45vw;overflow:auto;padding-left:10px;padding-right:10px;text-align:inherit;width:25vw}.ui-toc-dropdown>.toc{max-height:calc(70vh - 100px);overflow:auto}.ui-toc-dropdown[dir=rtl] .nav{letter-spacing:.0029em;padding-right:0}.ui-toc-dropdown a{overflow:hidden;text-overflow:ellipsis;white-space:pre}.ui-toc-dropdown .nav>li>a{color:#767676;display:block;font-size:13px;font-weight:500;padding:4px 20px}.ui-toc-dropdown .nav>li:first-child:last-child>ul,.ui-toc-dropdown .toc.expand ul{display:block}.ui-toc-dropdown .nav>li>a:focus,.ui-toc-dropdown .nav>li>a:hover{background-color:initial;border-left:1px solid #000;color:#000;padding-left:19px;text-decoration:none}.ui-toc-dropdown[dir=rtl] .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav>li>a:hover{border-left:none;border-right:1px solid #000;padding-right:19px}.ui-toc-dropdown .nav>.active:focus>a,.ui-toc-dropdown .nav>.active:hover>a,.ui-toc-dropdown .nav>.active>a{background-color:initial;border-left:2px solid #000;color:#000;font-weight:700;padding-left:18px}.ui-toc-dropdown[dir=rtl] .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav>.active>a{border-left:none;border-right:2px solid #000;padding-right:18px}.ui-toc-dropdown .nav .nav{display:none;padding-bottom:10px}.ui-toc-dropdown .nav>.active>ul{display:block}.ui-toc-dropdown .nav .nav>li>a{font-size:12px;font-weight:400;padding-bottom:1px;padding-left:30px;padding-top:1px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a{padding-right:30px}.ui-toc-dropdown .nav .nav>li>ul>li>a{font-size:12px;font-weight:400;padding-bottom:1px;padding-left:40px;padding-top:1px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a{padding-right:40px}.ui-toc-dropdown .nav .nav>li>a:focus,.ui-toc-dropdown .nav .nav>li>a:hover{padding-left:29px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:hover{padding-right:29px}.ui-toc-dropdown .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown .nav .nav>li>ul>li>a:hover{padding-left:39px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:hover{padding-right:39px}.ui-toc-dropdown .nav .nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>a{font-weight:500;padding-left:28px}.ui-toc-dropdown[dir=rtl] .nav .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>a{padding-right:28px}.ui-toc-dropdown .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active>a{font-weight:500;padding-left:38px}.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active>a{padding-right:38px}.markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html[lang^=ja] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ ゴシック,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html[lang=zh-tw] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html[lang=zh-cn] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html .markdown-body[lang^=ja]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ ゴシック,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html .markdown-body[lang=zh-tw]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html .markdown-body[lang=zh-cn]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html[lang^=ja] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Meiryo UI,MS PGothic,ＭＳ Ｐゴシック,sans-serif}html[lang=zh-tw] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Microsoft JhengHei UI,微軟正黑UI,sans-serif}html[lang=zh-cn] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Microsoft YaHei UI,微软雅黑UI,sans-serif}html .ui-toc-dropdown[lang^=ja]{font-family:Source Sans Pro,Helvetica,Arial,Meiryo UI,MS PGothic,ＭＳ Ｐゴシック,sans-serif}html .ui-toc-dropdown[lang=zh-tw]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft JhengHei UI,微軟正黑UI,sans-serif}html .ui-toc-dropdown[lang=zh-cn]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft YaHei UI,微软雅黑UI,sans-serif}.ui-affix-toc{max-height:70vh;max-width:15vw;overflow:auto;position:fixed;top:0}.back-to-top,.expand-toggle,.go-to-bottom{color:#999;display:block;font-size:12px;font-weight:500;margin-left:10px;margin-top:10px;padding:4px 10px}.back-to-top:focus,.back-to-top:hover,.expand-toggle:focus,.expand-toggle:hover,.go-to-bottom:focus,.go-to-bottom:hover{color:#563d7c;text-decoration:none}.back-to-top,.go-to-bottom{margin-top:0}.ui-user-icon{background-position:50%;background-repeat:no-repeat;background-size:cover;border-radius:50%;display:block;height:20px;margin-bottom:2px;margin-right:5px;margin-top:2px;width:20px}.ui-user-icon.small{display:inline-block;height:18px;margin:0 0 .2em;vertical-align:middle;width:18px}.ui-infobar>small>span{line-height:22px}.ui-infobar>small .dropdown{display:inline-block}.ui-infobar>small .dropdown a:focus,.ui-infobar>small .dropdown a:hover{text-decoration:none}.ui-more-info{color:#888;cursor:pointer;vertical-align:middle}.ui-more-info .fa{font-size:16px}.ui-connectedGithub,.ui-published-note{color:#888}.ui-connectedGithub{line-height:23px;white-space:nowrap}.ui-connectedGithub a.file-path{color:#888;padding-left:22px;text-decoration:none}.ui-connectedGithub a.file-path:active,.ui-connectedGithub a.file-path:hover{color:#888;text-decoration:underline}.ui-connectedGithub .fa{font-size:20px}.ui-published-note .fa{font-size:20px;vertical-align:top}.unselectable{-webkit-user-select:none;-o-user-select:none;user-select:none}.selectable{-webkit-user-select:text;-o-user-select:text;user-select:text}.inline-spoiler-section{cursor:pointer}.inline-spoiler-section .spoiler-text{background-color:#333;border-radius:2px}.inline-spoiler-section .spoiler-text>*{opacity:0}.inline-spoiler-section .spoiler-img{filter:blur(10px)}.inline-spoiler-section.raw{background-color:#333;border-radius:2px}.inline-spoiler-section.raw>*{opacity:0}.inline-spoiler-section.unveil{cursor:auto}.inline-spoiler-section.unveil .spoiler-text{background-color:#3333331a}.inline-spoiler-section.unveil .spoiler-text>*{opacity:1}.inline-spoiler-section.unveil .spoiler-img{filter:none}@media print{blockquote,div,img,pre,table{page-break-inside:avoid!important}a[href]:after{font-size:12px!important}}.markdown-body.slides{color:#222;position:relative;z-index:1}.markdown-body.slides:before{background-color:currentColor;bottom:0;box-shadow:0 0 0 50vw;content:"";display:block;left:0;position:absolute;right:0;top:0;z-index:-1}.markdown-body.slides section[data-markdown]{background-color:#fff;margin-bottom:1.5em;position:relative;text-align:center}.markdown-body.slides section[data-markdown] code{text-align:left}.markdown-body.slides section[data-markdown]:before{content:"";display:block;padding-bottom:56.23%}.markdown-body.slides section[data-markdown]>div:first-child{left:1em;max-height:100%;overflow:hidden;position:absolute;right:1em;top:50%;transform:translateY(-50%)}.markdown-body.slides section[data-markdown]>ul{display:inline-block}.markdown-body.slides>section>section+section:after{border:3px solid #777;content:"";height:1.5em;position:absolute;right:1em;top:-1.5em}.site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,sans-serif}html[lang^=ja] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ ゴシック,sans-serif}html[lang=zh-tw] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html[lang=zh-cn] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}body{font-smoothing:subpixel-antialiased!important;-webkit-font-smoothing:subpixel-antialiased!important;-moz-osx-font-smoothing:auto!important;-webkit-overflow-scrolling:touch;font-family:Source Sans Pro,Helvetica,Arial,sans-serif;letter-spacing:.025em}html[lang^=ja] body{font-family:Source Sans Pro,Helvetica,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ ゴシック,sans-serif}html[lang=zh-tw] body{font-family:Source Sans Pro,Helvetica,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html[lang=zh-cn] body{font-family:Source Sans Pro,Helvetica,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}abbr[data-original-title],abbr[title]{cursor:help}body.modal-open{overflow-y:auto;padding-right:0!important}svg{text-shadow:none}
    </style>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" integrity="sha256-3Jy/GbSLrg0o9y5Z5n1uw0qxZECH7C6OQpVBgNFYa0g=" crossorigin="anonymous"></script>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js" integrity="sha256-g6iAfvZp+nDQ2TdTR/VVKJf3bGro4ub5fvWSWVRi2NE=" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js" integrity="sha256-8E4Is26QH0bD52WoQpcB+R/tcWQtpzlCojrybUd7Mxo=" crossorigin="anonymous"></script>
    <![endif]-->
</head>

<body>
    <div id="doc" class="markdown-body container-fluid comment-inner comment-enabled" data-hard-breaks="true"><h3 id="Critical-The-function-mintAvatarNftGating-will-always-revert" data-id="Critical-The-function-mintAvatarNftGating-will-always-revert"><a class="anchor hidden-xs" href="#Critical-The-function-mintAvatarNftGating-will-always-revert" title="Critical-The-function-mintAvatarNftGating-will-always-revert"><span class="octicon octicon-link"></span></a><span>[Critical] The function </span><code>mintAvatarNftGating(...)</code><span> will always revert</span></h3><p><strong><span>File(s)</span></strong><span>: </span><a href="https://github.com/NethermindEth/NM-0151-Security-Review-ZkSync-Libertas/blob/b82b37ddad2f35fe7f6697a2a10407078a552ea3/achievo-contracts/contracts/upgradeables/AvatarBoundV1.sol#L197-L216" target="_blank" rel="noopener"><code>AvatarBoundV1.sol</code></a></p><p><strong><span>Description</span></strong><span>:  The function </span><code>mintAvatarNftGating(...)</code><span> will mint AvatarBound NFT to the caller who owns NFT gating.</span></p><p><span>However, even though the caller meets the requirements above, the function will still revert because the function </span><code>revealNFTGatingToken(...)</code><span>. This function implements </span><code>onlyRole(MINTER_ROLE)</code><span>, which checks if the caller has this role. This role most likely won’t be granted to every user calling </span><code>mintAvatarNftGating(...)</code><span>. Therefore, the function will revert as a result of the missing role.</span></p><pre><code class="Solidity hljs">   <span class="hljs-keyword">function</span> reveal<span class="hljs-constructor">NFTGatingToken(<span class="hljs-params">uint256</span> <span class="hljs-params">tokenId</span>)</span> public only<span class="hljs-constructor">Role(MINTER_ROLE)</span> whenNotPaused {
        <span class="hljs-constructor">IOpenMint(<span class="hljs-params">gatingNFTAddress</span>)</span>.reveal(tokenId, revealURI);
        emit <span class="hljs-constructor">NFTRevealed(<span class="hljs-params">tokenId</span>, <span class="hljs-params">_msgSender</span>()</span>, gatingNFTAddress);
    }
</code></pre><p><strong><span>Recommendation(s)</span></strong><span>: Consider changing the access control for the </span><code>revealNFTGatingToken(...)</code><span>.</span></p><p><strong><span>Status</span></strong><span>: Fixed</span></p><p><strong><span>Update from the client</span></strong><span>:</span></p><hr><h3 id="High-Incorrect-check-for-ERC1155-soulbound-tokens-batch-transfers" data-id="High-Incorrect-check-for-ERC1155-soulbound-tokens-batch-transfers"><a class="anchor hidden-xs" href="#High-Incorrect-check-for-ERC1155-soulbound-tokens-batch-transfers" title="High-Incorrect-check-for-ERC1155-soulbound-tokens-batch-transfers"><span class="octicon octicon-link"></span></a><span>[High] Incorrect check for ERC1155 soulbound tokens batch transfers</span></h3><p><strong><span>File(s)</span></strong><span>: </span><a href="" target="_blank" rel="noopener"><code>SoulBound1155.sol</code></a><span>, </span><a href="" target="_blank" rel="noopener"><code>ItemBound.sol</code></a></p><p><strong><span>Description</span></strong><span>: The </span><code>SoulBound1155</code><span> and </span><code>ItemBound</code><span> contracts mint ERC1155 tokens. The tokens can be soulbounded to a specific user address during minting, meaning those users should not be able to transfer those tokens. The same tokens can be minted to another user as non-soulbounded tokens, meaning that this user can transfer tokens. One address may hold both soulbound tokens and non-soulbound tokens. Whether the token is soulbounded to a specific user address is defined during mint by the parameter </span><code>soulBound</code><span> and registered with the function </span><code>_soulbound(...)</code><span>. The ability to transfer tokens is checked during the transfer in the modifier </span><code>soulboundCheck(...)</code><span> and </span><code>soulboundCheckBatch(...)</code><span>. Another set of modifiers updates the state of soulbound tokens: </span><code>syncSoulbound(...)</code><span> and </span><code>syncBatchSoulbound(...)</code><span>. Those checks, however, do not work properly during batched transfer with </span><code>safeBatchTransferFrom(...)</code><span>, which allows the user to transfer soulbound tokens. Consider the following scenario:</span></p><ul>
<li><span>Bob holds one soulbound token id=1</span></li>
<li><span>Alice holds one non-soulbound token id=1</span></li>
<li><span>Alice transfers one token id=1 to Bob</span></li>
<li><span>Bob holds one soulbounded token id=1 and one non-soulbounded token id=1</span></li>
<li><span>Bob transfers two tokens id=1 (including the soulbound one) to Eve by calling:</span><br>
<code>safeBatchTransferFrom(from=Bob, to=Eve, tokenIds=[1, 1], amounts=[1, 1], data="")</code></li>
<li><span>Eve now holds two non-soulbound tokens id=1</span></li>
</ul><p><span>The presented scenario allows for breaking the core functionality of soulbound tokens i.e., non-transferability. The issue exists because of ineffective checks in </span><code>soulboundCheckBatch(...)</code><span> presented below:</span></p><pre><code class="solidity hljs"><span class="hljs-function"><span class="hljs-keyword">modifier</span> <span class="hljs-title">soulboundCheckBatch</span>(<span class="hljs-params">
    <span class="hljs-keyword">address</span> <span class="hljs-keyword">from</span>,
    <span class="hljs-keyword">address</span> to,
    <span class="hljs-keyword">uint256</span>[] <span class="hljs-keyword">memory</span> tokenIds,
    <span class="hljs-keyword">uint256</span>[] <span class="hljs-keyword">memory</span> amounts,
    <span class="hljs-keyword">uint256</span>[] <span class="hljs-keyword">memory</span> totalAmounts
</span>) </span>{
    <span class="hljs-built_in">require</span>(tokenIds.<span class="hljs-built_in">length</span> <span class="hljs-operator">=</span><span class="hljs-operator">=</span> amounts.<span class="hljs-built_in">length</span>, <span class="hljs-string">"ERCSoulbound: tokenIds and amounts length mismatch"</span>);

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">uint256</span> i <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i <span class="hljs-operator">&lt;</span> tokenIds.<span class="hljs-built_in">length</span>; i<span class="hljs-operator">+</span><span class="hljs-operator">+</span>) {
        _checkMultipleAmounts(<span class="hljs-keyword">from</span>, to, tokenIds[i], amounts[i], totalAmounts[i]);
    }
    <span class="hljs-keyword">_</span>;
}
</code></pre><p><span>The modifier </span><code>soulboundCheckBatch(...)</code><span> calls in a loop </span><code>_checkMultipleAmounts(...)</code><span>:</span></p><pre><code class="solidity hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_checkMultipleAmounts</span>(<span class="hljs-params"><span class="hljs-keyword">address</span> <span class="hljs-keyword">from</span>, <span class="hljs-keyword">address</span> to, <span class="hljs-keyword">uint256</span> tokenId, <span class="hljs-keyword">uint256</span> amount, <span class="hljs-keyword">uint256</span> totalAmount</span>) <span class="hljs-title"><span class="hljs-keyword">private</span></span> <span class="hljs-title"><span class="hljs-keyword">view</span></span> </span>{
    <span class="hljs-built_in">require</span>(<span class="hljs-keyword">from</span> <span class="hljs-operator">!</span><span class="hljs-operator">=</span> <span class="hljs-keyword">address</span>(<span class="hljs-number">0</span>), <span class="hljs-string">"ERCSoulbound: can't be zero address"</span>);
    <span class="hljs-built_in">require</span>(amount <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>, <span class="hljs-string">"ERCSoulbound: can't be zero amount"</span>);
    <span class="hljs-built_in">require</span>(amount <span class="hljs-operator">&lt;</span><span class="hljs-operator">=</span> totalAmount, <span class="hljs-string">"ERCSoulbound: can't transfer more than you have"</span>);
    <span class="hljs-comment">// check if from or to whitelist addresses let it through</span>
    <span class="hljs-keyword">if</span> (whitelistAddresses[<span class="hljs-keyword">from</span>] <span class="hljs-operator">|</span><span class="hljs-operator">|</span> whitelistAddresses[to]) {
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">if</span> (totalAmount <span class="hljs-operator">-</span> _soulbounds[<span class="hljs-keyword">from</span>][tokenId] <span class="hljs-operator">&lt;</span> amount) {
        <span class="hljs-keyword">revert</span>(<span class="hljs-string">"ERCSoulbound: The amount of soulbounded tokens is more than the amount of tokens to be transferred"</span>);
    }
}
</code></pre><p><span>The </span><code>_checkMultipleAmounts(...)</code><span> checks if the transfered tokens include only non-soulbounded tokens. However, during the batch transfer with </span><code>safeBatchTransferFrom(...)</code><span>, malicious user may provide the same token multiple times (e.g., ids=[1,1], amounts=[1,1]) , and the check in </span><code>_checkMultipleAmounts(...)</code><span> are performed on the same state, effectively checking multiple times the same thing, i.e., whether the user can send amount=1 of token id=1. After the check, the transfers are performed, and the user sends amount=2 of token id=1, where one token is non-soulbounded. Additionally, the update of the balance of soulbound tokens performed in </span><code>syncBatchSoulbound(...)</code><span> will update only the malicious sender’s balance of soulbound tokens, and the receiver receives non-soulbound tokens.</span></p><p><strong><span>Recommendation(s)</span></strong><span>: Ensure that the soulbound tokens are non-transferrable in both </span><code>Soulbound1155</code><span> and </span><code>ItemBound</code><span> token contracts.</span></p><p><strong><span>Status</span></strong><span>: Fixed</span></p><p><strong><span>Update from the client</span></strong><span>:</span></p><hr><h3 id="High-User-can-burn-soulbound-tokens-with-burnBatch" data-id="High-User-can-burn-soulbound-tokens-with-burnBatch"><a class="anchor hidden-xs" href="#High-User-can-burn-soulbound-tokens-with-burnBatch" title="High-User-can-burn-soulbound-tokens-with-burnBatch"><span class="octicon octicon-link"></span></a><span>[High] User can burn soulbound tokens with </span><code>burnBatch(...)</code></h3><p><strong><span>File(s)</span></strong><span>: </span><a href="" target="_blank" rel="noopener"><code>SoulBound1155.sol</code></a><span>, </span><a href="" target="_blank" rel="noopener"><code>ItemBound.sol</code></a></p><p><strong><span>Description</span></strong><span>: The holder of soulbound tokens should not be able to burn them. This property is checked in the modifiers </span><code>soulboundCheck(...)</code><span> and </span><code>soulboundCheckBatch(...)</code><span>. However, if the user holds both soulbound and non-soulbound tokens with the same </span><code>id</code><span>, it is possible to burn soulbound tokens by calling </span><code>burnBatch(...)</code><span>. Consider the following scenario:</span></p><ul>
<li><span>Bob holds amount=1 soulbound token and amount=1 non-soulbound token with id=1</span></li>
<li><span>Bob calls </span><code>burnBatch(account=Bob, tokenIds=[1, 1], amounts=[1, 1])</code><span> and burns all tokens, including soulbound one</span></li>
</ul><p><span>This issue is possible because </span><code>soulboundCheckBatch(...)</code><span> calls in a loop </span><code>_checkMultipleAmounts(...)</code><span>, which effectively performs the same checks multiple times. This allows the user to burn multiple tokens with the same </span><code>id</code><span> by burning them in a batch. Note that this issue exists in both </span><code>SoulBound1155</code><span> and </span><code>ItemBound</code><span> contracts.</span><br>
<span>Refer to the issue “Incorrect check for soulbound tokens batch transfers” for a more in-depth explanation.</span></p><p><strong><span>Recommendation(s)</span></strong><span>: Ensure that the soulbound tokens can’t be burned in both </span><code>Soulbound1155</code><span> and </span><code>ItemBound</code><span> token contracts.</span></p><p><strong><span>Status</span></strong><span>: Fixed</span></p><p><strong><span>Update from the client</span></strong><span>:</span></p><hr><h3 id="High-User-may-mint-any-token-ID" data-id="High-User-may-mint-any-token-ID"><a class="anchor hidden-xs" href="#High-User-may-mint-any-token-ID" title="High-User-may-mint-any-token-ID"><span class="octicon octicon-link"></span></a><span>[High] User may mint any token ID</span></h3><p><strong><span>File(s)</span></strong><span>: </span><a href="" target="_blank" rel="noopener"><code>Soulbound1155.sol</code></a></p><p><strong><span>Description</span></strong><span>: The signed message required to mint tokens contains only the address and nonce but does not contain the </span><code>id</code><span>. Therefore, the provided token </span><code>id</code><span> is arbitrary. This may result in:</span></p><ul>
<li><span>minting token by a user that should not be allowed to mint</span></li>
<li><span>inconsistency between off-chain and on-chain data</span></li>
</ul><p><strong><span>Recommendation(s)</span></strong><span>: Consider adding token </span><code>id</code><span> in the signed message.</span></p><p><strong><span>Status</span></strong><span>: Fixed</span></p><p><strong><span>Update from the client</span></strong><span>:</span></p><hr><h3 id="High-AvatarBoundV1-soulbound-tokens-transfer-on-mint" data-id="High-AvatarBoundV1-soulbound-tokens-transfer-on-mint"><a class="anchor hidden-xs" href="#High-AvatarBoundV1-soulbound-tokens-transfer-on-mint" title="High-AvatarBoundV1-soulbound-tokens-transfer-on-mint"><span class="octicon octicon-link"></span></a><span>[High] </span><code>AvatarBoundV1</code><span> soulbound tokens transfer on mint</span></h3><p><strong><span>File(s)</span></strong><span>: </span><a href="" target="_blank" rel="noopener"><code>AvatarBoundV1.sol</code></a></p><p><strong><span>Description</span></strong><span>: The </span><code>AvatarBoundV1</code><span> is an ERC712 soulbound token. The address for which this token is minted should not be able to transfer it. However, the malicious receiver, during the safe mint, may reenter the </span><code>AvatarBoundV1</code><span> and call </span><code>AvatarBoundV1.transferFrom(...)</code><span> to transfer the token to another address (A). This not only breaks the soulbound property of the receiver but also, the new address A is able to transfer the token further. The issue exists because the function </span><code>mint(...)</code><span> calls inherited from </span><code>ERC721Upgradeable</code><span> function </span><code>_safeMint(...)</code><span>, presented below:</span></p><pre><code class="solidity hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_safeMint</span>(<span class="hljs-params"><span class="hljs-keyword">address</span> to, <span class="hljs-keyword">uint256</span> tokenId, <span class="hljs-keyword">bytes</span> <span class="hljs-keyword">memory</span> data</span>) <span class="hljs-title"><span class="hljs-keyword">internal</span></span> <span class="hljs-title"><span class="hljs-keyword">virtual</span></span> </span>{
    _mint(to, tokenId);
    <span class="hljs-built_in">require</span>(
        _checkOnERC721Received(<span class="hljs-keyword">address</span>(<span class="hljs-number">0</span>), to, tokenId, data),
        <span class="hljs-string">"ERC721: transfer to non ERC721Receiver implementer"</span>
    );
}
</code></pre><p><span>This function checks if the receiver is correct ERC721Receiver with </span><code>_checkOnERC721Received(...)</code><span>:</span></p><pre><code class="solidity hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_checkOnERC721Received</span>(<span class="hljs-params">
    <span class="hljs-keyword">address</span> <span class="hljs-keyword">from</span>,
    <span class="hljs-keyword">address</span> to,
    <span class="hljs-keyword">uint256</span> tokenId,
    <span class="hljs-keyword">bytes</span> <span class="hljs-keyword">memory</span> data
</span>) <span class="hljs-title"><span class="hljs-keyword">private</span></span> <span class="hljs-title"><span class="hljs-keyword">returns</span></span> (<span class="hljs-params"><span class="hljs-keyword">bool</span></span>) </span>{
    <span class="hljs-keyword">if</span> (to.isContract()) {
        <span class="hljs-keyword">try</span> IERC721ReceiverUpgradeable(to).onERC721Received(_msgSender(), <span class="hljs-keyword">from</span>, tokenId, data) <span class="hljs-keyword">returns</span> (<span class="hljs-keyword">bytes4</span> retval) {
            <span class="hljs-keyword">return</span> retval <span class="hljs-operator">=</span><span class="hljs-operator">=</span> IERC721ReceiverUpgradeable.onERC721Received.<span class="hljs-built_in">selector</span>;
        } <span class="hljs-keyword">catch</span> (<span class="hljs-keyword">bytes</span> <span class="hljs-keyword">memory</span> reason) {
            <span class="hljs-keyword">if</span> (reason.<span class="hljs-built_in">length</span> <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">revert</span>(<span class="hljs-string">"ERC721: transfer to non ERC721Receiver implementer"</span>);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">/// @solidity memory-safe-assembly</span>
                <span class="hljs-keyword">assembly</span> {
                    <span class="hljs-keyword">revert</span>(<span class="hljs-built_in">add</span>(<span class="hljs-number">32</span>, reason), <span class="hljs-built_in">mload</span>(reason))
                }
            }
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}
</code></pre><p><span>The check is done after the mint by performing the external call to the receiver with </span><code>IERC721ReceiverUpgradeable(to).onERC721Received(...)</code><span>. The malicious receiver may be a contract, which reenters the </span><code>AvatarBoundV1</code><span> to transfer the token to another address.</span><br>
<span>Note that currently the </span><code>AvatarBoundV1</code><span> prohibits any token transfers by overriding </span><code>_beforeTokenTransfer(...)</code><span> with modifier </span><code>soulboundAddressCheck(from)</code><span>:</span></p><pre><code class="solidity hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_beforeTokenTransfer</span>(<span class="hljs-params">
    <span class="hljs-keyword">address</span> <span class="hljs-keyword">from</span>,
    <span class="hljs-keyword">address</span> to,
    <span class="hljs-keyword">uint256</span> tokenId,
    <span class="hljs-keyword">uint256</span> batch
</span>) <span class="hljs-title"><span class="hljs-keyword">internal</span></span> <span class="hljs-title"><span class="hljs-keyword">override</span></span>(<span class="hljs-params">ERC721Upgradeable, ERC721EnumerableUpgradeable</span>) <span class="hljs-title">soulboundAddressCheck</span>(<span class="hljs-params"><span class="hljs-keyword">from</span></span>) </span>{
    <span class="hljs-built_in">super</span>._beforeTokenTransfer(<span class="hljs-keyword">from</span>, to, tokenId, batch);
}
</code></pre><p><span>However, this check does not fix the presented scenario since the address is registered as soulbound after the </span><code>_safeMint(...)</code><span> call. Therefore, the transfer during mint is still possible.</span></p><p><strong><span>Recommendation(s)</span></strong><span>: If the </span><code>AvatarBoundV1</code><span> tokens should not be transferrable, consider disabling transfer functions instead of adding a modifier to the </span><code>_beforeTokenTransfer(...)</code><span> hook.</span></p><p><strong><span>Status</span></strong><span>: Unresolved</span></p><p><strong><span>Update from the client</span></strong><span>:</span></p><p><strong><span>Update from Nethermind</span></strong><span>: The issue is not fixed, since it is possible with </span><code>tranfserFrom(...)</code><span>. Consider applying </span><code>nonReentrant</code><span> check to the </span><code>tranfserFrom(...)</code><span> function.</span></p><hr><h3 id="Low-Admin-can-mint-any-amount-of-SoulBound1155-tokens-with-adminMintBatch" data-id="Low-Admin-can-mint-any-amount-of-SoulBound1155-tokens-with-adminMintBatch"><a class="anchor hidden-xs" href="#Low-Admin-can-mint-any-amount-of-SoulBound1155-tokens-with-adminMintBatch" title="Low-Admin-can-mint-any-amount-of-SoulBound1155-tokens-with-adminMintBatch"><span class="octicon octicon-link"></span></a><span>[Low] Admin can mint any amount of SoulBound1155 tokens with </span><code>adminMintBatch(...)</code></h3><p><strong><span>File(s)</span></strong><span>: </span><a href="" target="_blank" rel="noopener"><code>SoulBound1155.sol</code></a></p><p><strong><span>Description</span></strong><span>: The caller of the </span><code>SoulBound1155.adminMintBatch(...)</code><span> is able to mint any arbitrary amount of tokens by passing to repeated values in the arrays </span><code>ids</code><span> and </span><code>amounts</code><span>. Below, we present the modifier </span><code>canMintBatch(...)</code><span> that checks if the provided amount is correct:</span></p><pre><code class="solidity hljs"><span class="hljs-function"><span class="hljs-keyword">modifier</span> <span class="hljs-title">canMintBatch</span>(<span class="hljs-params">
    <span class="hljs-keyword">address</span> to,
    <span class="hljs-keyword">uint256</span>[] <span class="hljs-keyword">memory</span> tokenIds,
    <span class="hljs-keyword">uint256</span>[] <span class="hljs-keyword">memory</span> amounts
</span>) </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">uint256</span> i <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i <span class="hljs-operator">&lt;</span> tokenIds.<span class="hljs-built_in">length</span>; i<span class="hljs-operator">+</span><span class="hljs-operator">+</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-operator">!</span>tokenExists[tokenIds[i]]) {
            <span class="hljs-keyword">revert</span>(<span class="hljs-string">"Token not exist"</span>);
        }

        <span class="hljs-keyword">if</span> (isMinted[tokenIds[i]][to]) {
            <span class="hljs-keyword">revert</span>(<span class="hljs-string">"Already minted"</span>);
        }

        <span class="hljs-keyword">if</span> (amounts[i] <span class="hljs-operator">&gt;</span> MAX_PER_MINT) {
            <span class="hljs-keyword">revert</span>(<span class="hljs-string">"Exceed max mint"</span>);
        }
    }

    <span class="hljs-keyword">_</span>;
}
</code></pre><p><span>This modifier will iterate through each element of both arrays and check if the token was already minted to the given address and if the amount is less than </span><code>MAX_PER_MINT</code><span>. If provided arrays are, e.g., </span><code>ids=[1,1,1]</code><span>, </span><code>amounts=[1,1,1]</code><span>, then the checks in the </span><code>canMintBatch(...)</code><span> modifier will pass since the token with </span><code>id=1</code><span> was not yet minted, and each value in </span><code>amounts</code><span> is correct. Those arrays are used in </span><code>ERC1155._mintBatch(...)</code><span>, which, as a result, mints to the given address </span><code>amount=3</code><span> of token </span><code>id=1</code><span>. Note that this issue is called only by the </span><code>MINTER_ROLE</code><span>, but allows for breaking the assumption of minting </span><code>amount=1</code><span> of tokens.</span></p><p><strong><span>Recommendation(s)</span></strong><span>: Consider restricting duplicates in modifier </span><code>canMintBatch(...)</code><span>.</span></p><p><strong><span>Status</span></strong><span>: Unresolved</span></p><p><strong><span>Update from the client</span></strong><span>: We’re deleting the modifier, because is for admin purposes</span></p><hr><h3 id="Low-It-is-possible-to-bypass-the-maximum-number-of-items-per-mint-by-passing-duplicate-item-IDs" data-id="Low-It-is-possible-to-bypass-the-maximum-number-of-items-per-mint-by-passing-duplicate-item-IDs"><a class="anchor hidden-xs" href="#Low-It-is-possible-to-bypass-the-maximum-number-of-items-per-mint-by-passing-duplicate-item-IDs" title="Low-It-is-possible-to-bypass-the-maximum-number-of-items-per-mint-by-passing-duplicate-item-IDs"><span class="octicon octicon-link"></span></a><span class="ui-comment-inline-span">[Low] It is possible to bypass the maximum number of items per mint by passing duplicate item </span><code>IDs</code></h3><p><strong><span>File(s)</span></strong><span>: </span><a href="" target="_blank" rel="noopener"><code>ItemBound.sol</code></a></p><p><strong><span>Description</span></strong><span>: The </span><code>mint(...)</code><span> function is used by users to mint the items for their Avatars. It validates the signature provided by the user as well as the </span><code>amount</code><span> of items that the user wants to mint, not to exceed the </span><code>MAX_PER_MINT</code><span> amount. The information about which item tokens should be minted is passed in the </span><code>data</code><span> argument. The problem present in the </span><code>mint(...)</code><span> function is that this data can contain duplicated values. Under the assumption that the project’s backend does not check the uniqueness of items to be minted, it is possible for the user to specify the same item multiple times in the </span><code>data</code><span> argument and, as a result, mint one item more than once, exceeding the </span><code>MAX_PER_MINT</code><span> amount.</span></p><p><strong><span>Recommendation(s)</span></strong><span>: One of the solutions would be to mint a single token at a time instead of using the </span><code>_mintBatch(...)</code><span> function. If that’s not possible, consider implementing a check on a smart contract level to make sure that the item data passed by the user contains unique values to prevent the minting of the same item multiple times.</span></p><p><strong><span>Status</span></strong><span>: Unresolved</span></p><p data-original-title="" title=""><strong><span>Update from the client</span></strong><span>:</span></p><hr><h3 id="Best-Practice-__gap-variable" data-id="Best-Practice-__gap-variable"><a class="anchor hidden-xs" href="#Best-Practice-__gap-variable" title="Best-Practice-__gap-variable"><span class="octicon octicon-link"></span></a><span>[Best Practice] </span><code>__gap</code><span> variable</span></h3><p><strong><span>File(s)</span></strong><span>: </span><a href="" target="_blank" rel="noopener"><code>upgradeables/ERCWhitelistSignatureUpgradeable.sol</code></a><span>, </span><a href="" target="_blank" rel="noopener"><code>upgradeables/ERCSoulboundUpgradeable.sol</code></a><span>, </span><a href="" target="_blank" rel="noopener"><code>upgradeables/AvatarBoundV1.sol</code></a></p><p><strong><span>Description</span></strong><span>: The </span><code>__gap</code><span> variable is used in upgradeable contracts that are inherited by other contracts. It is used to reserve empty space to avoid shits in the storage layout during contract update that modifies the number of occupied storage slots. Below, we list the best practices in using the </span><code>__gap</code><span> that are not met in the current project:</span></p><ul>
<li><code>__gap</code><span> should be used only for upgradeable contracts that are going to be inherited. Currently, the </span><code>AvatarBoundV1(...)</code><span> is not inherited by other contracts, but it also contains </span><code>__gap</code></li>
<li><span>the size of the </span><code>__gap</code><span> array should be calculated so that the amount of storage used by a contract always adds up to the same number (usually 50 storage slots). E.g., if the four storage slots are occupied by state variables, the gap should be </span><code>__gap[46]</code><span>. This helps to maintain the contract updates when the number of reserved contract storage is a round, easy-to-remember number, like 50.</span></li>
<li><code>__gap</code><span> is usually defined as the last storage variable</span></li>
</ul><p><strong><span>Recommendation(s)</span></strong><span>: Consider applying best practices to the usage of </span><code>__gap</code><span>.</span></p><p><strong><span>Status</span></strong><span>: Fixed</span></p><p><strong><span>Update from the client</span></strong><span>:</span></p><hr><h3 id="Info-Unnecessary-checks" data-id="Info-Unnecessary-checks"><a class="anchor hidden-xs" href="#Info-Unnecessary-checks" title="Info-Unnecessary-checks"><span class="octicon octicon-link"></span></a><span>[Info] Unnecessary checks</span></h3><p><strong><span>File(s):</span></strong><span> </span><a href="https://github.com/NethermindEth/NM-0151-Security-Review-ZkSync-Libertas/blob/f13592e7620e249e1bc98ddb7f4a27575c858b9d/achievo-contracts/contracts/ERCSoulbound.sol#L135-L149" target="_blank" rel="noopener"><code>ERCSoulbound.sol</code></a></p><p><strong><span>Description</span></strong><span>: In several parts of the application, the smart contracts perform checks for data validation, which are unnecessary as they are implemented in the inherited functions or do not prevent any security risk.</span><br>
<span>The function </span><code>_checkMultipleAmounts(...)</code><span> is called on every transfer or burn in </span><code>Soulbound1155</code><span> and </span><code>ItemBound</code><span> contracts. However, some checks in this function are unnecessary, as they are either done again in the functions inherited with ERC1155 or do not introduce additional security. Below, we list checks that are duplicated in </span><code>_checkMultipleAmounts(...)</code><span>, with corresponding reasoning:</span></p><ul>
<li><code>require(amount &lt;= totalAmount, "ERCSoulbound: can't transfer more than you have")</code><span> - the check is done again in 	</span><code>ERC1155._safeTransferFrom(...)/_safeBatchTransferFrom(...)</code><span> and </span><code>ERC1155._burn(...)/_burnBatch(...)</code></li>
<li><code>require(from != address(0), "ERCSoulbound: can't be zero address")</code><span> - the check is done again in </span><code>ERC1155._burn(...)/_burnBatch(...)</code><span>. Note, however, that this is not checked during transfer in </span><code>ERC1155</code><span>.</span><br>
<span>Additionally, the </span><code>Soulbound1155.__mintBatch(...)</code><span> calls the </span><code>_soulboundBatch(...)</code><span>. This function performs check </span><code>require(tokenIds.length == amounts. length, "ERCSoulbound: tokenIds and amounts length mismatch")</code><span> which verifies the length equality of arrays. However, the same check is repeated in the </span><code>_mintBatch(...)</code><span> function inherited from </span><code>ERC1155</code><span>, which is also called in </span><code>Soulbound1155.__mintBatch(...)</code><span>.</span></li>
</ul><p><strong><span>Recommendation(s):</span></strong><span> Consider avoiding double-checks to simplify the code and save gas.</span></p><p><strong><span>Status:</span></strong><span> Unresolved</span></p><p><strong><span>Update from the client:</span></strong></p><hr><h3 id="Best-Practice-Incorrect-comment" data-id="Best-Practice-Incorrect-comment"><a class="anchor hidden-xs" href="#Best-Practice-Incorrect-comment" title="Best-Practice-Incorrect-comment"><span class="octicon octicon-link"></span></a><span>[Best Practice] Incorrect comment</span></h3><p><strong><span>File(s)</span></strong><span>: </span><a href="" target="_blank" rel="noopener"><code>SoulBound1155.sol</code></a></p><p><strong><span>Description</span></strong><span>: The comment in the beginning of the contract states that:</span></p><pre><code>///@notice This contract is for mock for WETH token.
</code></pre><p><strong><span>Recommendation(s)</span></strong><span>: Consider removing misleading comment.</span></p><p><strong><span>Status:</span></strong><span> Unresolved</span></p><p><strong><span>Update from the client</span></strong><span>: We’re deleting this contract, is deprecated</span></p><hr><h3 id="Low-Unused-functions-inherited-in-token-contracts" data-id="Low-Unused-functions-inherited-in-token-contracts"><a class="anchor hidden-xs" href="#Low-Unused-functions-inherited-in-token-contracts" title="Low-Unused-functions-inherited-in-token-contracts"><span class="octicon octicon-link"></span></a><span>[Low] Unused functions inherited in token contracts</span></h3><p><strong><span>File(s)</span></strong><span>: </span><a href="" target="_blank" rel="noopener"><code>ERCSoulBound.sol</code></a><span>, </span><a href="" target="_blank" rel="noopener"><code>ERCSoulboundUpgradeable.sol</code></a></p><p><strong><span>Description</span></strong><span>: Some functions are inherited from the contracts </span><code>ERCSoulBound</code><span> and </span><code>ERCSoulboundUpgradeable</code><span> but are not used. This may mislead users, as the functions called return incorrect information. Unused functions also unnecessarily increase contract size. Below, we list unused functions that are inherited.</span><br>
<code>AvatarBoundV1</code><span> inherits from </span><code>ERCSoulboundUpgradeable</code><span> but does not use:</span></p><ul>
<li><span>modifier</span><code>soulboundTokenCheck(...)</code></li>
<li><span>modifier </span><code>soulboundCheck(...)</code></li>
<li><span>modifier </span><code>soulboundCheckBatch(...)</code></li>
<li><span>modifier </span><code>syncSoulboundToken(...)</code></li>
<li><span>modifier </span><code>syncSoulbound(...)</code></li>
<li><span>modifier </span><code>syncBatchSoulbound(...)</code></li>
<li><span>modifier </span><code>revertOperation(...)</code></li>
<li><span>internal function </span><code>_updateWhitelistAddress(...)</code></li>
<li><span>internal function </span><code>_checkMultipleAmounts(...)</code></li>
<li><span>internal function </span><code>_soulboundToken(...)</code></li>
<li><span>internal function </span><code>_soulbound(...)</code></li>
<li><span>internal function </span><code>_soulboundBatch(...)</code></li>
<li><span>external function </span><code>isSoulboundToken(...)</code><span> is exposed, but mapping </span><code>_soulboundTokens</code><span> is not used</span></li>
<li><span>external function </span><code>soulboundBalance(...)</code><span> is exposed, but mapping </span><code>_soulbounds</code><span> is not used</span></li>
<li><span>internal function </span><code>__ERCSoulboundUpgradable_init(...)</code><span> is used, but is empty</span></li>
</ul><p><code>ItemBound</code><span> and </span><code>Soulbound1155</code><span> inherit from </span><code>ERCSoulbound</code><span>, but do not use:</span></p><ul>
<li><span>modifier </span><code>soulboundTokenCheck(...)</code></li>
<li><span>modifier </span><code>soulboundAddressCheck(...)</code></li>
<li><span>modifier </span><code>syncSoulboundToken(...)</code></li>
<li><span>modifier </span><code>revertOperation(...)</code></li>
<li><span>internal function </span><code>_soulboundToken(...)</code></li>
<li><span>internal function </span><code>_soulboundAddress(...)</code></li>
<li><span>external function </span><code>isSoulboundToken(...)</code><span> is exposed, but mapping </span><code>_soulboundTokens</code><span> is not used</span></li>
<li><span>external function </span><code>isSoulboundAddress(...)</code><span> is exposed, but mapping </span><code>_soulboundAddresses</code><span> is not used</span></li>
</ul><p><span>The external functions that the contracts inherit and expose may return misleading results to the user. Consider, e.g., call to external function </span><code>AvatarBoundV1.isSoulboundToken(...)</code><span>, which always returns </span><code>false</code><span>, but the user may expect that provided for </span><code>tokenId</code><span> it should return </span><code>true</code><span>.</span></p><p><strong><span>Recommendation(s)</span></strong><span>: Removing unused modifiers and functions from </span><code>ERCSoulBound</code><span> and </span><code>ERCSoulboundUpgradeable</code><span>.</span></p><p><strong><span>Status:</span></strong><span> Unresolved</span></p><p><strong><span>Update from the client</span></strong><span>:</span></p><hr><h3 id="Low-Centralization-risks" data-id="Low-Centralization-risks"><a class="anchor hidden-xs" href="#Low-Centralization-risks" title="Low-Centralization-risks"><span class="octicon octicon-link"></span></a><span>[Low] Centralization risks</span></h3><p><strong><span>File(s)</span></strong><span>: </span><a href="" target="_blank" rel="noopener"><code>AvatarBoundV1.sol</code></a><span>, </span><a href="" target="_blank" rel="noopener"><code>Soulbound1155.sol</code></a><span>, </span><a href="" target="_blank" rel="noopener"><code>ItemBound.sol</code></a></p><p><strong><span>Description</span></strong><span>: The Libertas Omnibus project has centralized points. Centralization risks are connected with scenarios that can negatively impact protocol if the private keys of admins or privileged roles are compromised. The risks include the following areas:</span></p><ul>
<li><span>direct, one-step role granting</span></li>
<li><span>functions accessible by privileged roles have weakened security checks than the public functions</span></li>
<li><span>some aspects of token mint security are ensured by the correct data signing by the backend</span></li>
</ul><p><strong><span>Recommendation(s)</span></strong><span>: Consider implementing stronger checks to increase the security of centralized points in the application.</span></p><p><strong><span>Status</span></strong><span>: Unresolved</span></p><p><strong><span>Update from the client</span></strong><span>: We’re aware of this, We’ll be sharing this info with both teams to publish the comms</span></p><hr><h3 id="Best-Practice-Code-layout-does-not-conform-to-the-official-Solidity-Style-Guideliness" data-id="Best-Practice-Code-layout-does-not-conform-to-the-official-Solidity-Style-Guideliness"><a class="anchor hidden-xs" href="#Best-Practice-Code-layout-does-not-conform-to-the-official-Solidity-Style-Guideliness" title="Best-Practice-Code-layout-does-not-conform-to-the-official-Solidity-Style-Guideliness"><span class="octicon octicon-link"></span></a><span>[Best Practice] Code layout does not conform to the official Solidity Style Guideliness</span></h3><p><strong><span>File(s)</span></strong><span>: </span><a href="" target="_blank" rel="noopener"><code>*</code></a></p><p><strong><span>Description</span></strong><span>: Solidity language has a set of </span><a href="https://docs.soliditylang.org/en/latest/style-guide.html" target="_blank" rel="noopener"><span>general rules</span></a><span> to keep the code style consistent across different projects, contracts and functions. A non-exhaustive list of files where some of these rules are broken is presented below:</span></p><ul>
<li><code>ItemBound.sol</code><span>: The </span><code>constructor</code><span> is defined after </span><code>public</code><span> functions.</span></li>
<li><code>AvatarBoundV1.sol</code><span>: The </span><code>constructor</code><span> is defined before state variables.</span></li>
<li><code>ERCSoulbound.sol</code><span>, </span><code>ERCSoulboundUpgradeable.sol</code><span>: The </span><code>external</code><span> functions are defined before </span><code>private</code><span> and </span><code>internal</code><span> ones.</span></li>
</ul><p><strong><span>Recommendation(s)</span></strong><span>: Consider reviewing and applying the official </span><a href="https://docs.soliditylang.org/en/latest/style-guide.html#order-of-functions" target="_blank" rel="noopener"><span>Solidity Style Guideliness</span></a><span> to make the code easier to navigate and comprehend for the readers.</span></p><p><strong><span>Status</span></strong><span>: Unresolved</span></p><p><strong><span>Update from the client</span></strong><span>:</span></p><hr><h3 id="Info-Redundant-modifiers" data-id="Info-Redundant-modifiers"><a class="anchor hidden-xs" href="#Info-Redundant-modifiers" title="Info-Redundant-modifiers"><span class="octicon octicon-link"></span></a><span>[Info] Redundant modifiers</span></h3><p><span>File(s): </span><a href="https://github.com/NethermindEth/NM-0151-Security-Review-ZkSync-Libertas/blob/f13592e7620e249e1bc98ddb7f4a27575c858b9d/achievo-contracts/contracts/upgradeables/AvatarBoundV1.sol#L194-L211" target="_blank" rel="noopener"><span>AvatarBoundV1.sol</span></a></p><p><strong><span>Description</span></strong><span>: The AvatarBoundV1.sol uses the </span><code>PausableUpgradeable</code><span> extension for the pausing functionality. Several internal functions use the </span><code>whenNotPaused</code><span> modifier, which is unnecessary as the public functions, which expose these internal functions, already implement this modifier. The modifier can be deleted from the following functions to reduce the gas cost:</span></p><ul>
<li><code>revealNFTGatingToken(...)</code></li>
<li><code>mintItem(...)</code></li>
<li><code>mintRandomItem(...)</code></li>
</ul><p><strong><span>Recommendation(s)</span></strong><span>: Consider deleting the </span><code>whenNotPaused</code><span> modifier to remove the redundant checks and save gas in the process.</span></p><p><strong><span>Status</span></strong><span>: Unresolved</span></p><p><strong><span>Update from the client</span></strong><span>:</span></p><hr><h2 id="Issues-in-fix-version" data-id="Issues-in-fix-version"><a class="anchor hidden-xs" href="#Issues-in-fix-version" title="Issues-in-fix-version"><span class="octicon octicon-link"></span></a><span>Issues in fix version</span></h2><h3 id="Info-The-function-getAllItems-does-not-return-nothing" data-id="Info-The-function-getAllItems-does-not-return-nothing"><a class="anchor hidden-xs" href="#Info-The-function-getAllItems-does-not-return-nothing" title="Info-The-function-getAllItems-does-not-return-nothing"><span class="octicon octicon-link"></span></a><span>[Info] The function </span><code>getAllItems(...)</code><span> does not return nothing</span></h3><p><strong><span>File(s)</span></strong><span>: </span><a href="" target="_blank" rel="noopener"><code>Soulbound1155.sol</code></a></p><p><strong><span>Description</span></strong><span>: The function </span><code>getAllItems(...)</code><span> returns user’s balance of all tokens. However, the array </span><code>itemIds</code><span> is never set.</span></p><p><strong><span>Recommendation(s)</span></strong><span>: Consider adding token </span><code>ids</code><span> to </span><code>itemIds</code><span> or remove the </span><code>getAllItems(...)</code><span class="ui-comment-inline-span"> function.</span></p><p><strong><span class="ui-comment-inline-span">Status</span></strong><span class="ui-comment-inline-span">:</span><span> Unresolved</span></p><p><strong><span>Update from the client</span></strong><span>: This contract will be deleted</span></p><hr></div>
    <div class="ui-toc dropup unselectable hidden-print" style="display:none;">
        <div class="pull-right dropdown">
            <a id="tocLabel" class="ui-toc-label btn btn-default" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false" title="Table of content">
                <i class="fa fa-bars"></i>
            </a>
            <ul id="ui-toc" class="ui-toc-dropdown dropdown-menu" aria-labelledby="tocLabel">
                <div class="toc"><ul class="nav">
<li class="invisable-node"><ul class="nav">
<li><a href="#Critical-The-function-mintAvatarNftGating-will-always-revert" title="[Critical] The function mintAvatarNftGating(...) will always revert">[Critical] The function mintAvatarNftGating(...) will always revert</a></li>
<li><a href="#High-Incorrect-check-for-ERC1155-soulbound-tokens-batch-transfers" title="[High] Incorrect check for ERC1155 soulbound tokens batch transfers">[High] Incorrect check for ERC1155 soulbound tokens batch transfers</a></li>
<li><a href="#High-User-can-burn-soulbound-tokens-with-burnBatch" title="[High] User can burn soulbound tokens with burnBatch(...)">[High] User can burn soulbound tokens with burnBatch(...)</a></li>
<li><a href="#High-User-may-mint-any-token-ID" title="[High] User may mint any token ID">[High] User may mint any token ID</a></li>
<li><a href="#High-AvatarBoundV1-soulbound-tokens-transfer-on-mint" title="[High] AvatarBoundV1 soulbound tokens transfer on mint">[High] AvatarBoundV1 soulbound tokens transfer on mint</a></li>
<li><a href="#Low-Admin-can-mint-any-amount-of-SoulBound1155-tokens-with-adminMintBatch" title="[Low] Admin can mint any amount of SoulBound1155 tokens with adminMintBatch(...)">[Low] Admin can mint any amount of SoulBound1155 tokens with adminMintBatch(...)</a></li>
<li><a href="#Low-It-is-possible-to-bypass-the-maximum-number-of-items-per-mint-by-passing-duplicate-item-IDs" title="[Low] It is possible to bypass the maximum number of items per mint by passing duplicate item IDs">[Low] It is possible to bypass the maximum number of items per mint by passing duplicate item IDs</a></li>
<li><a href="#Best-Practice-__gap-variable" title="[Best Practice] __gap variable">[Best Practice] __gap variable</a></li>
<li><a href="#Info-Unnecessary-checks" title="[Info] Unnecessary checks">[Info] Unnecessary checks</a></li>
<li><a href="#Best-Practice-Incorrect-comment" title="[Best Practice] Incorrect comment">[Best Practice] Incorrect comment</a></li>
<li><a href="#Low-Unused-functions-inherited-in-token-contracts" title="[Low] Unused functions inherited in token contracts">[Low] Unused functions inherited in token contracts</a></li>
<li><a href="#Low-Centralization-risks" title="[Low] Centralization risks">[Low] Centralization risks</a></li>
<li><a href="#Best-Practice-Code-layout-does-not-conform-to-the-official-Solidity-Style-Guideliness" title="[Best Practice] Code layout does not conform to the official Solidity Style Guideliness">[Best Practice] Code layout does not conform to the official Solidity Style Guideliness</a></li>
<li><a href="#Info-Redundant-modifiers" title="[Info] Redundant modifiers">[Info] Redundant modifiers</a></li>
</ul>
</li>
<li><a href="#Issues-in-fix-version" title="Issues in fix version">Issues in fix version</a><ul class="nav">
<li><a href="#Info-The-function-getAllItems-does-not-return-nothing" title="[Info] The function getAllItems(...) does not return nothing">[Info] The function getAllItems(...) does not return nothing</a></li>
</ul>
</li>
</ul>
</div><div class="toc-menu"><a class="expand-toggle" href="#">Expand all</a><a class="back-to-top" href="#">Back to top</a><a class="go-to-bottom" href="#">Go to bottom</a></div>
            </ul>
        </div>
    </div>
    <div id="ui-toc-affix" class="ui-affix-toc ui-toc-dropdown unselectable hidden-print" data-spy="affix" style="top:17px;display:none;" null null>
        <div class="toc"><ul class="nav">
<li class="invisable-node"><ul class="nav">
<li><a href="#Critical-The-function-mintAvatarNftGating-will-always-revert" title="[Critical] The function mintAvatarNftGating(...) will always revert">[Critical] The function mintAvatarNftGating(...) will always revert</a></li>
<li><a href="#High-Incorrect-check-for-ERC1155-soulbound-tokens-batch-transfers" title="[High] Incorrect check for ERC1155 soulbound tokens batch transfers">[High] Incorrect check for ERC1155 soulbound tokens batch transfers</a></li>
<li><a href="#High-User-can-burn-soulbound-tokens-with-burnBatch" title="[High] User can burn soulbound tokens with burnBatch(...)">[High] User can burn soulbound tokens with burnBatch(...)</a></li>
<li><a href="#High-User-may-mint-any-token-ID" title="[High] User may mint any token ID">[High] User may mint any token ID</a></li>
<li><a href="#High-AvatarBoundV1-soulbound-tokens-transfer-on-mint" title="[High] AvatarBoundV1 soulbound tokens transfer on mint">[High] AvatarBoundV1 soulbound tokens transfer on mint</a></li>
<li><a href="#Low-Admin-can-mint-any-amount-of-SoulBound1155-tokens-with-adminMintBatch" title="[Low] Admin can mint any amount of SoulBound1155 tokens with adminMintBatch(...)">[Low] Admin can mint any amount of SoulBound1155 tokens with adminMintBatch(...)</a></li>
<li><a href="#Low-It-is-possible-to-bypass-the-maximum-number-of-items-per-mint-by-passing-duplicate-item-IDs" title="[Low] It is possible to bypass the maximum number of items per mint by passing duplicate item IDs">[Low] It is possible to bypass the maximum number of items per mint by passing duplicate item IDs</a></li>
<li><a href="#Best-Practice-__gap-variable" title="[Best Practice] __gap variable">[Best Practice] __gap variable</a></li>
<li><a href="#Info-Unnecessary-checks" title="[Info] Unnecessary checks">[Info] Unnecessary checks</a></li>
<li><a href="#Best-Practice-Incorrect-comment" title="[Best Practice] Incorrect comment">[Best Practice] Incorrect comment</a></li>
<li><a href="#Low-Unused-functions-inherited-in-token-contracts" title="[Low] Unused functions inherited in token contracts">[Low] Unused functions inherited in token contracts</a></li>
<li><a href="#Low-Centralization-risks" title="[Low] Centralization risks">[Low] Centralization risks</a></li>
<li><a href="#Best-Practice-Code-layout-does-not-conform-to-the-official-Solidity-Style-Guideliness" title="[Best Practice] Code layout does not conform to the official Solidity Style Guideliness">[Best Practice] Code layout does not conform to the official Solidity Style Guideliness</a></li>
<li><a href="#Info-Redundant-modifiers" title="[Info] Redundant modifiers">[Info] Redundant modifiers</a></li>
</ul>
</li>
<li><a href="#Issues-in-fix-version" title="Issues in fix version">Issues in fix version</a><ul class="nav">
<li><a href="#Info-The-function-getAllItems-does-not-return-nothing" title="[Info] The function getAllItems(...) does not return nothing">[Info] The function getAllItems(...) does not return nothing</a></li>
</ul>
</li>
</ul>
</div><div class="toc-menu"><a class="expand-toggle" href="#">Expand all</a><a class="back-to-top" href="#">Back to top</a><a class="go-to-bottom" href="#">Go to bottom</a></div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gist-embed/2.6.0/gist-embed.min.js" integrity="sha256-KyF2D6xPIJUW5sUDSs93vWyZm+1RzIpKCexxElmxl8g=" crossorigin="anonymous" defer></script>
    <script>
        var markdown = $(".markdown-body");
        //smooth all hash trigger scrolling
        function smoothHashScroll() {
            var hashElements = $("a[href^='#']").toArray();
            for (var i = 0; i < hashElements.length; i++) {
                var element = hashElements[i];
                var $element = $(element);
                var hash = element.hash;
                if (hash) {
                    $element.on('click', function (e) {
                        // store hash
                        var hash = this.hash;
                        if ($(hash).length <= 0) return;
                        // prevent default anchor click behavior
                        e.preventDefault();
                        // animate
                        $('body, html').stop(true, true).animate({
                            scrollTop: $(hash).offset().top
                        }, 100, "linear", function () {
                            // when done, add hash to url
                            // (default click behaviour)
                            window.location.hash = hash;
                        });
                    });
                }
            }
        }

        smoothHashScroll();
        var toc = $('.ui-toc');
        var tocAffix = $('.ui-affix-toc');
        var tocDropdown = $('.ui-toc-dropdown');
        //toc
        tocDropdown.click(function (e) {
            e.stopPropagation();
        });

        var enoughForAffixToc = true;

        function generateScrollspy() {
            $(document.body).scrollspy({
                target: ''
            });
            $(document.body).scrollspy('refresh');
            if (enoughForAffixToc) {
                toc.hide();
                tocAffix.show();
            } else {
                tocAffix.hide();
                toc.show();
            }
            $(document.body).scroll();
        }

        function windowResize() {
            //toc right
            var paddingRight = parseFloat(markdown.css('padding-right'));
            var right = ($(window).width() - (markdown.offset().left + markdown.outerWidth() - paddingRight));
            toc.css('right', right + 'px');
            //affix toc left
            var newbool;
            var rightMargin = (markdown.parent().outerWidth() - markdown.outerWidth()) / 2;
            //for ipad or wider device
            if (rightMargin >= 133) {
                newbool = true;
                var affixLeftMargin = (tocAffix.outerWidth() - tocAffix.width()) / 2;
                var left = markdown.offset().left + markdown.outerWidth() - affixLeftMargin;
                tocAffix.css('left', left + 'px');
            } else {
                newbool = false;
            }
            if (newbool != enoughForAffixToc) {
                enoughForAffixToc = newbool;
                generateScrollspy();
            }
        }
        $(window).resize(function () {
            windowResize();
        });
        $(document).ready(function () {
            windowResize();
            generateScrollspy();
        });

        //remove hash
        function removeHash() {
            window.location.hash = '';
        }

        var backtotop = $('.back-to-top');
        var gotobottom = $('.go-to-bottom');

        backtotop.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToTop)
                scrollToTop();
            removeHash();
        });
        gotobottom.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToBottom)
                scrollToBottom();
            removeHash();
        });

        var toggle = $('.expand-toggle');
        var tocExpand = false;

        checkExpandToggle();
        toggle.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            tocExpand = !tocExpand;
            checkExpandToggle();
        })

        function checkExpandToggle () {
            var toc = $('.ui-toc-dropdown .toc');
            var toggle = $('.expand-toggle');
            if (!tocExpand) {
                toc.removeClass('expand');
                toggle.text('Expand all');
            } else {
                toc.addClass('expand');
                toggle.text('Collapse all');
            }
        }

        function scrollToTop() {
            $('body, html').stop(true, true).animate({
                scrollTop: 0
            }, 100, "linear");
        }

        function scrollToBottom() {
            $('body, html').stop(true, true).animate({
                scrollTop: $(document.body)[0].scrollHeight
            }, 100, "linear");
        }
    </script>
</body>

</html>
